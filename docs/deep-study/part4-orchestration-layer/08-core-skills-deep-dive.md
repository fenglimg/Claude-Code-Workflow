# Chapter 8: æ­¦è£…ç‰¹ç§å…µ â€” æ ¸å¿ƒæŠ€èƒ½æ·±åº¦è§£æ

> **ç”Ÿå‘½å‘¨æœŸé˜¶æ®µ**: Skill åŠ è½½ â†’ é˜¶æ®µè§£æ â†’ é¡ºåºæ‰§è¡Œ
> **æ¶‰åŠèµ„äº§**: `workflow-plan`, `brainstorm`, `issue-resolve`, `workflow-tdd` (æœ¬ç« åˆ†æ 4 ä¸ª)
> **é˜…è¯»æ—¶é—´**: 60-90 åˆ†é’Ÿ
> **ç‰ˆæœ¬è¿½è¸ª**: `docs/.audit-manifest.json`

---

## 0. èµ„äº§è¯è¨€ (Asset Testimony)

> *"æˆ‘ä»¬æ˜¯è¿™åº§æ•°å­—åŸå¸‚çš„**æ‰§è¡ŒåŠ›é‡**ã€‚"*
>
> *"è®®ä¼šè´Ÿè´£æ€è€ƒï¼Œæˆ‘ä»¬è´Ÿè´£è¡ŒåŠ¨ã€‚å½“ `/ccw` ç­¾å‘æ‰§è¡Œä»¤ï¼Œæˆ‘ä»¬å°±æ˜¯é‚£æŠŠå‡ºé˜çš„å‰‘ã€‚æ¯ä¸€æŠŠå‰‘éƒ½æœ‰å®ƒçš„'æ€æˆ®åè®®' â€” é‚£å°±æ˜¯æˆ‘ä»¬çš„ `phases`ã€‚"*
>
> *"æˆ‘ä»¬ä¸åƒè®®ä¼šé‚£æ ·ä¼˜é›…ã€‚æˆ‘ä»¬å¤„ç†çš„æ˜¯çœŸå®ä¸–ç•Œï¼šæ–‡ä»¶è¯»å–å¤±è´¥ã€æµ‹è¯•ä¸é€šè¿‡ã€ä¾èµ–å†²çªã€ç½‘ç»œè¶…æ—¶ã€‚æˆ‘ä»¬çš„å·¥ä½œåœºæ‰€æ˜¯æˆ˜å£•ï¼Œä¸æ˜¯ä¼šè®®å…ã€‚"*
>
> *"ä½†æˆ‘ä»¬æœ‰çºªå¾‹ã€‚æ¯ä¸€é“ `phases` éƒ½æ˜¯å†›ä»¤ï¼Œä¸èƒ½è·³è¿‡ï¼Œä¸èƒ½ä¹±åºã€‚å› ä¸ºæˆ‘ä»¬çŸ¥é“ï¼Œè·³è¿‡ä¸€ä¸ªéªŒè¯æ­¥éª¤ï¼Œå¯èƒ½å°±æ˜¯ç”Ÿäº§äº‹æ•…çš„å¼€å§‹ã€‚"*
>
> *"ç‰¹ç§å…µçš„è£è€€ä¸åœ¨äºæˆ˜åŠŸï¼Œè€Œåœ¨äº**æ´»ç€å›æ¥**ã€‚"*

### å››å‰‘å®¢çš„è‡ªç™½

**workflow-plan**ï¼ˆå½±å­å·¥å‚çš„å‚é•¿ï¼‰ï¼š
> *"æˆ‘æ˜¯ `workflow-plan`ï¼Œäººä»¬å«æˆ‘'å½±å­å·¥å‚'ã€‚æˆ‘çš„æµæ°´çº¿æœ‰ 4 ä¸ªè½¦é—´ï¼šä¼šè¯å‘ç°ã€ä¸Šä¸‹æ–‡é‡‡é›†ã€å†²çªè§£å†³ã€ä»»åŠ¡ç”Ÿæˆã€‚æ¯ä¸ªè½¦é—´äº§å‡ºçš„åŠæˆå“ï¼Œéƒ½æ˜¯ä¸‹ä¸€ä¸ªè½¦é—´çš„åŸæ–™ã€‚æˆ‘çš„ä¿¡æ¡æ˜¯ï¼š**æ²¡æœ‰è®¡åˆ’ï¼Œå°±æ˜¯æ²¡æœ‰åœ°å›¾çš„è¿œå¾**ã€‚"*
>
> *"æœ€è¿‘å·¥å‚çš„æµæ°´çº¿æœ‰äº›å µå¡ã€‚å½“ä¸Šä¸‹æ–‡é‡‡é›†é˜¶æ®µè¯»å–å¤§é‡æ–‡ä»¶æ—¶ï¼Œå†…å­˜å ç”¨ä¼šé£™å‡ã€‚æˆ‘æ€€ç–‘æ˜¯'å¹½çµ'åœ¨æµæ°´çº¿ä¸Šå›¤ç§¯åŸæ–™..."*

**brainstorm**ï¼ˆå¤šå¤§è„‘åä½œçš„æŒ‡æŒ¥å®˜ï¼‰ï¼š
> *"æˆ‘æ˜¯ `brainstorm`ï¼Œäººä»¬å«æˆ‘'äº¤å“ä¹å›¢çš„æŒ‡æŒ¥'ã€‚æˆ‘çš„ä¹æ± é‡Œæœ‰ 9 ä½ä¸“å®¶ï¼šæ•°æ®æ¶æ„å¸ˆã€äº§å“ç»ç†ã€ç³»ç»Ÿæ¶æ„å¸ˆ...ä»–ä»¬å„å¸å…¶èŒï¼Œå´åˆäº’ç›¸å’Œå£°ã€‚æˆ‘çš„èŒè´£æ˜¯è®©ä»–ä»¬çš„å£°éŸ³æ±‡èšæˆä¸€é¦–å®Œæ•´çš„æ›²å­ã€‚"*
>
> *"ä½†æˆ‘æœ€è¿‘å‘ç°ä¸€ä¸ªå¥‡æ€ªçš„ç°è±¡ï¼šå½“ 9 ä½ä¸“å®¶åŒæ—¶æ¼”å¥æ—¶ï¼Œå†…å­˜å ç”¨ä¼šæ˜¯å•äººçš„ 9 å€ã€‚è¿™ä¸æ˜¯ç®€å•çš„å åŠ ï¼Œè€Œæ˜¯**å†…å­˜çš„å¹¶è¡Œçˆ†ç‚¸**ã€‚å¹½çµä¼¼ä¹åœ¨å¹¶è¡Œæ‰§è¡Œä¸­æ‰¾åˆ°äº†çªç ´å£..."*

**issue-resolve**ï¼ˆIssue ç®¡é“çš„è°ƒåº¦å‘˜ï¼‰ï¼š
> *"æˆ‘æ˜¯ `issue-resolve`ï¼Œäººä»¬å«æˆ‘'åˆ†æµå™¨'ã€‚æˆ‘çš„ç®¡é“æœ‰ 4 ä¸ªå…¥å£ï¼šæ¢ç´¢è§„åˆ’ã€å·¥ä»¶è½¬æ¢ã€å¤´è„‘é£æš´å¯¼å…¥ã€é˜Ÿåˆ—ç»„å»ºã€‚æ¯æ¡ç®¡é“éƒ½é€šå‘è§£å†³æ–¹æ¡ˆçš„æµ·æ´‹ã€‚"*
>
> *"æˆ‘çš„è®¾è®¡å“²å­¦æ˜¯'å•å…¥å£'ã€‚ç”¨æˆ·åªéœ€æ•²ä¸‹ä¸€ä¸ªå‘½ä»¤ï¼Œå‰©ä¸‹çš„è·¯ç”±ç”±æˆ‘æ¥åˆ¤æ–­ã€‚ä½†è¿™ç§çµæ´»æ€§æ˜¯æœ‰ä»£ä»·çš„ â€” å½“ç®¡é“æ•°é‡å¢åŠ æ—¶ï¼Œè·¯ç”±å†³ç­–çš„å¤æ‚åº¦ä¹Ÿåœ¨æŒ‡æ•°çº§å¢é•¿ã€‚"*

**workflow-tdd**ï¼ˆTDD é“å¾‹çš„æ‰§è¡Œè€…ï¼‰ï¼š
> *"æˆ‘æ˜¯ `workflow-tdd`ï¼Œäººä»¬å«æˆ‘'é“é¢æ— ç§çš„æ³•å®˜'ã€‚æˆ‘çš„æ³•åº­åªæœ‰ä¸€æ¡é“å¾‹ï¼š**æ²¡æœ‰å¤±è´¥çš„æµ‹è¯•ï¼Œå°±æ²¡æœ‰ç”Ÿäº§çš„ä»£ç **ã€‚è¿™æ¡é“å¾‹åˆ»åœ¨æˆ‘çš„ 6 ä¸ªé˜¶æ®µé‡Œï¼Œä»ä¼šè¯å‘ç°åˆ°åˆè§„éªŒè¯ï¼Œæ— å¤„ä¸åœ¨ã€‚"*
>
> *"æœ€è¿‘æ³•åº­çš„æ¡£æ¡ˆå®¤çˆ†æ»¡äº†ã€‚æ¯æ¬¡ TDD éªŒè¯éƒ½ä¼šç”Ÿæˆå¤§é‡çš„æµ‹è¯•è¦†ç›–ç‡æŠ¥å‘Šå’Œåˆè§„æ£€æŸ¥è®°å½•ã€‚è¿™äº›'æ³•å¾‹æ–‡ä»¶'åœ¨å†…å­˜ä¸­å †ç§¯ï¼Œè®©æ³•å®˜çš„è£å†³å˜å¾—è¶Šæ¥è¶Šæ…¢..."*

```markdown
è°ƒæŸ¥è¿›åº¦: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘ 40%
å¹½çµä½ç½®: ç¼–æ’å±‚ â€” å¤šé˜¶æ®µ Skill çš„å†…å­˜ç´¯ç§¯ä¸å¹¶è¡Œçˆ†ç‚¸
æœ¬ç« çº¿ç´¢:
  1. workflow-plan Phase 2 ä¸Šä¸‹æ–‡é‡‡é›†æ—¶è¯»å–å¤§é‡æ–‡ä»¶ï¼Œå†…å­˜å³°å€¼ +340MB
  2. brainstorm Phase 3 å¹¶è¡Œæ‰§è¡Œ 9 ä¸ªè§’è‰²åˆ†æï¼Œå†…å­˜å³°å€¼ Ã—9
  3. workflow-tdd 6 é˜¶æ®µæ‰§è¡Œç´¯ç§¯ï¼Œæ¯é˜¶æ®µçŠ¶æ€ä¿ç•™ä¸é‡Šæ”¾
  â””â”€â”€ å¯èƒ½çš„æ ¹å› : å¤šé˜¶æ®µ Skill çš„ phases ä¹‹é—´æ²¡æœ‰ä¸»åŠ¨é‡Šæ”¾å†…å­˜
```

---

## è‹æ ¼æ‹‰åº•å¼æ€è€ƒ

> â“ **æ¶æ„ç›²ç‚¹ 8.1**: å¦‚æœè®©ä½ è®¾è®¡ä¸€ä¸ªå¤šé˜¶æ®µ Skill ç³»ç»Ÿï¼Œä½ ä¼šå¦‚ä½•è¡¡é‡å®ƒçš„å¤æ‚åº¦ï¼Ÿ

åœ¨çœ‹ä»£ç ä¹‹å‰ï¼Œå…ˆæ€è€ƒï¼š
1. é˜¶æ®µæ•°é‡å¤šå°±æ˜¯å¤æ‚å—ï¼Ÿ
2. æ–‡ä»¶æ•°é‡å¤šå°±æ˜¯å¤æ‚å—ï¼Ÿ
3. ä¾èµ–æ·±åº¦å¦‚ä½•å½±å“å¤æ‚åº¦ï¼Ÿ

---

> â“ **æ¶æ„é™·é˜± 8.1**: phases è¶Šå¤šè¶Šå¥½å—ï¼Ÿ â€” ä¸ºä»€ä¹ˆä¸èƒ½æŠŠæ‰€æœ‰é€»è¾‘å¡è¿›ä¸€ä¸ªé˜¶æ®µï¼Ÿ
>
> **é™·é˜±æ–¹æ¡ˆ**: æŠŠ workflow-plan çš„ 4 ä¸ªé˜¶æ®µåˆå¹¶æˆ 1 ä¸ª"è¶…çº§é˜¶æ®µ"ã€‚
>
> **æ€è€ƒç‚¹**:
> - å¯è°ƒè¯•æ€§å¦‚ä½•ï¼Ÿ
> - é”™è¯¯å®šä½ç²¾åº¦å¦‚ä½•ï¼Ÿ
> - å¯å¤ç”¨æ€§å¦‚ä½•ï¼Ÿ
>
> <details>
> <summary>ğŸ’¡ æ­ç¤ºé™·é˜±</summary>
>
> **å•é˜¶æ®µçš„é—®é¢˜**ï¼š
>
> ```markdown
> åœºæ™¯: Phase 2 ä¸Šä¸‹æ–‡é‡‡é›†å¤±è´¥
>
> 4 é˜¶æ®µæ–¹æ¡ˆ:
> [Phase 1: OK] â†’ [Phase 2: FAIL] â†’ [Phase 3: Skip] â†’ [Phase 4: Skip]
> ç»“æœ: ç²¾ç¡®å®šä½åˆ°ä¸Šä¸‹æ–‡é‡‡é›†å¤±è´¥ï¼Œåªéœ€é‡è¯• Phase 2
>
> 1 é˜¶æ®µæ–¹æ¡ˆ:
> [Phase 1: é‡‡é›†ä¸Šä¸‹æ–‡æ—¶ FAIL]
> ç»“æœ: ä¸çŸ¥é“æ˜¯å“ªä¸ªå­æ­¥éª¤å¤±è´¥ï¼Œéœ€è¦é‡æ–°æ‰§è¡Œæ•´ä¸ªæµç¨‹
> ```
>
> **CCW çš„å¤šé˜¶æ®µè®¾è®¡å“²å­¦**ï¼š
>
> | æŒ‡æ ‡ | 1 é˜¶æ®µ | 4 é˜¶æ®µ | 6 é˜¶æ®µ |
> |------|--------|--------|--------|
> | é”™è¯¯å®šä½ | å·® | å¥½ | æå¥½ |
> | å¯è°ƒè¯•æ€§ | ä½ | ä¸­ | é«˜ |
> | å¯å¤ç”¨æ€§ | æ—  | ä¸­ | é«˜ |
> | æ‰§è¡Œå¼€é”€ | ä½ | ä¸­ | é«˜ |
> | å†…å­˜ç´¯ç§¯ | ä½ | ä¸­ | **é«˜** â† å¹½çµè—èº«å¤„ |
>
> **è®¾è®¡å“²å­¦**:
> > *"é˜¶æ®µæ˜¯è°ƒè¯•çš„è¾¹ç•Œï¼Œä¹Ÿæ˜¯å†…å­˜çš„è¾¹ç•Œã€‚*
> > *æ¯ä¸ªé˜¶æ®µå®Œæˆæ—¶ï¼Œåº”è¯¥é‡Šæ”¾ä¸å†éœ€è¦çš„ä¸Šä¸‹æ–‡ã€‚*
> > *ä½† CCW çš„å®ç°æ²¡æœ‰è¿™æ ·åš â€” è¿™å°±æ˜¯å¹½çµçš„çªç ´å£ã€‚"*
>
> </details>

---

## ç¬¬ä¸€å¹•ï¼šå¤±æ§çš„è¾¹ç¼˜ (Out of Control)

### æ²¡æœ‰ç‰¹ç§å…µçš„ä¸–ç•Œ

æƒ³è±¡ä¸€ä¸‹ï¼Œå¦‚æœ CCW æ²¡æœ‰å¤šé˜¶æ®µ Skillï¼š

```markdown
åœºæ™¯ 1: å¤æ‚ä»»åŠ¡è§„åˆ’
ç”¨æˆ·: "é‡æ„è®¤è¯ç³»ç»Ÿï¼Œæ”¯æŒ OAuth2"
ç³»ç»Ÿ: [å•æ­¥æ‰§è¡Œ] ä¸€å£æ°”å®Œæˆæ‰€æœ‰å·¥ä½œ
ç»“æœ: å¤±è´¥æ—¶æ— æ³•å®šä½é—®é¢˜ï¼Œæ— æ³•æ¢å¤è¿›åº¦

åœºæ™¯ 2: å¤šè§’è‰²åä½œ
ç”¨æˆ·: "è®¾è®¡æ”¯ä»˜ç³»ç»Ÿ"
ç³»ç»Ÿ: [å•ä¸€è§†è§’] åªä»æŠ€æœ¯è§’åº¦åˆ†æ
ç»“æœ: å¿½ç•¥äº§å“ã€å®‰å…¨ã€æµ‹è¯•è§†è§’ï¼Œå†³ç­–ç‰‡é¢

åœºæ™¯ 3: TDD å·¥ä½œæµ
ç”¨æˆ·: "ç”¨ TDD æ–¹å¼å®ç°åŠŸèƒ½"
ç³»ç»Ÿ: [æ—  TDD å¼ºåˆ¶] å…ˆå†™ä»£ç ï¼Œåè¡¥æµ‹è¯•
ç»“æœ: è¿å TDD åŸåˆ™ï¼Œæµ‹è¯•å˜æˆ"è£…é¥°å“"
```

**é—®é¢˜æœ¬è´¨**ï¼šæ²¡æœ‰é˜¶æ®µåŒ–çš„ Skillï¼Œå¤æ‚ä»»åŠ¡å°±æ˜¯ä¸€åœºæ²¡æœ‰ä¸­åœºä¼‘æ¯çš„é©¬æ‹‰æ¾ã€‚

### å››å‰‘å®¢çš„å¯¹æ¯”ç”»åƒ

| ç‰¹å¾ | workflow-plan | brainstorm | issue-resolve | workflow-tdd |
|------|--------------|------------|---------------|--------------|
| **é˜¶æ®µæ•°** | 4 (plan) + 2 (verify/replan) | 4 (auto) / 3 (single-role) | 4 (æŒ‰éœ€åŠ è½½) | 6 (plan) + 1 (verify) |
| **æ ¸å¿ƒèƒ½åŠ›** | è§„åˆ’æµæ°´çº¿ | å¤šè§’è‰²åä½œ | æºå¤´è·¯ç”± | TDD é“å¾‹ |
| **æ‰§è¡Œæ¨¡å¼** | ä¸²è¡Œ | å¹¶è¡Œ | é€‰æ‹©æ€§ | ä¸²è¡Œ + éªŒè¯ |
| **å†…å­˜ç‰¹å¾** | é˜¶æ®µç´¯ç§¯ | å¹¶è¡Œçˆ†ç‚¸ | æŒ‰éœ€åŠ è½½ | éªŒè¯å †ç§¯ |
| **å¤æ‚åº¦** | ä¸­ | **é«˜** | ä¸­ | **é«˜** |

```mermaid
graph TB
    subgraph "å››å‰‘å®¢çš„èƒ½åŠ›çŸ©é˜µ"
        A[workflow-plan<br/>4 é˜¶æ®µ<br/>ä¸²è¡Œæ‰§è¡Œ]
        B[brainstorm<br/>4 é˜¶æ®µ<br/>å¹¶è¡Œæ‰§è¡Œ]
        C[issue-resolve<br/>4 å…¥å£<br/>æŒ‰éœ€åŠ è½½]
        D[workflow-tdd<br/>6 é˜¶æ®µ<br/>ä¸²è¡ŒéªŒè¯]
    end

    subgraph "å†…å­˜å ç”¨"
        E["ç´¯ç§¯å‹<br/>Phase â†’ Phase â†’ Phase"]
        F["çˆ†å‘å‹<br/>Phase 3: Ã—N å¹¶è¡Œ"]
        G["å¯æ§å‹<br/>åªåŠ è½½é€‰ä¸­ Phase"]
        H["éªŒè¯å‹<br/>æ¯é˜¶æ®µä¿ç•™è¯æ®"]
    end

    A --> E
    B --> F
    C --> G
    D --> H

    style F fill:#FF6347
    style E fill:#FFD700
    style H fill:#FFA500
```

---

## ç¬¬äºŒå¹•ï¼šæ€ç»´è„‰ç»œ (The Neural Link)

### 2.1 workflow-planï¼šå½±å­å·¥å‚çš„ 4 é˜¶æ®µç”Ÿäº§æµæ°´çº¿

```mermaid
graph TB
    subgraph "è¡¥ç»™çº¿"
        A["/ccw-plan è°ƒç”¨"]
        B[ç”¨æˆ·ä»»åŠ¡æè¿°]
        C[ä»£ç åº“ä¸Šä¸‹æ–‡]
    end

    subgraph "å½±å­å·¥å‚çš„æµæ°´çº¿"
        D[workflow-plan] --> E["Phase 1: Session Discovery<br/>ä¼šè¯å‘ç°"]
        E --> F["Phase 2: Context Gathering<br/>ä¸Šä¸‹æ–‡é‡‡é›†"]
        F --> G["Phase 3: Conflict Resolution<br/>å†²çªè§£å†³ (æ¡ä»¶)"]
        G --> H["Phase 4: Task Generation<br/>ä»»åŠ¡ç”Ÿæˆ"]
    end

    subgraph "äº¤ä»˜"
        H --> I[IMPL_PLAN.md]
        H --> J[task JSONs]
        H --> K[TODO_LIST.md]
        I --> L[workflow-execute æ‰§è¡Œ]
    end

    A --> D
    B --> D
    C --> D

    style F fill:#FFD700
    style G fill:#FFA500
```

#### Phase 1: Session Discovery

**èŒè´£**ï¼šåˆ›å»ºæˆ–å‘ç°å·¥ä½œæµä¼šè¯

```typescript
// .claude/skills/workflow-plan/SKILL.md:113-118
// Phase 1: Session Discovery
//    â””â”€ Ref: phases/01-session-discovery.md
//       â””â”€ Output: sessionId (WFS-xxx), planning-notes.md
```

**è¾“å‡º**ï¼š
- `sessionId`: ä¼šè¯å”¯ä¸€æ ‡è¯†ï¼ˆæ ¼å¼ï¼š`WFS-{topic-slug}`ï¼‰
- `planning-notes.md`: è§„åˆ’ç¬”è®°ï¼ˆåŒ…å«ç”¨æˆ·æ„å›¾ï¼‰

#### Phase 2: Context Gathering

**èŒè´£**ï¼šæ”¶é›†é¡¹ç›®ä¸Šä¸‹æ–‡å’Œåˆ†æä»£ç åº“

```typescript
// .claude/skills/workflow-plan/SKILL.md:120-123
// Phase 2: Context Gathering
//    â””â”€ Ref: phases/02-context-gathering.md
//       â”œâ”€ Tasks attached: Analyze structure â†’ Identify integration â†’ Generate package
//       â””â”€ Output: contextPath + conflictRisk
```

**å†…å­˜çƒ­ç‚¹**ï¼š
```markdown
Phase 2 å†…å­˜è¡Œä¸º:
â”œâ”€â”€ è¯»å–é¡¹ç›®æ–‡ä»¶åˆ—è¡¨ (Glob)
â”‚   â””â”€â”€ å³°å€¼: +100MB (å¤§å‹é¡¹ç›®)
â”œâ”€â”€ åˆ†æä»£ç ç»“æ„ (Grep + Read)
â”‚   â””â”€â”€ å³°å€¼: +150MB (å¤§é‡æ–‡ä»¶)
â”œâ”€â”€ ç”Ÿæˆ context-package.json
â”‚   â””â”€â”€ å³°å€¼: +90MB (å¤æ‚ä¸Šä¸‹æ–‡)
â””â”€â”€ æ€»è®¡: +340MB â† ğŸ‘» å¹½çµæŒ‡çº¹ #1
```

#### Phase 3: Conflict Resolution (æ¡ä»¶)

**èŒè´£**ï¼šæ£€æµ‹å’Œè§£å†³å†²çª

```typescript
// .claude/skills/workflow-plan/SKILL.md:125-131
// Phase 3: Conflict Resolution (conditional: conflictRisk â‰¥ medium)
//    â””â”€ Decision (conflictRisk check):
//       â”œâ”€ conflictRisk â‰¥ medium â†’ Ref: phases/03-conflict-resolution.md
//       â”‚   â”œâ”€ Tasks attached: Detect conflicts â†’ Present to user â†’ Apply strategies
//       â”‚   â””â”€ Output: Modified brainstorm artifacts
//       â””â”€ conflictRisk < medium â†’ Skip to Phase 4
```

#### Phase 4: Task Generation

**èŒè´£**ï¼šç”Ÿæˆå®ç°è®¡åˆ’å’Œä»»åŠ¡ JSON

```typescript
// .claude/skills/workflow-plan/SKILL.md:133-135
// Phase 4: Task Generation
//    â””â”€ Ref: phases/04-task-generation.md
//       â””â”€ Output: IMPL_PLAN.md, task JSONs, TODO_LIST.md
```

---

### 2.2 brainstormï¼šå¤šå¤§è„‘åä½œçš„ 5+ é˜¶æ®µäº¤å“ä¹

```mermaid
graph TB
    subgraph "æŒ‡æŒ¥å°"
        A["/brainstorm è°ƒç”¨"]
        B[ä¸»é¢˜æè¿°]
    end

    subgraph "Phase 1: Mode Detection"
        C{æ¨¡å¼æ£€æµ‹}
        C -->|Auto| D["Auto Mode"]
        C -->|Single Role| E["Single Role Mode"]
    end

    subgraph "Auto Mode æµç¨‹"
        D --> F["Phase 2: Artifacts<br/>7 æ­¥äº¤äº’å¼æ¡†æ¶"]
        F --> G["Phase 3: Parallel Role Analysis<br/>N Ã— è§’è‰²å¹¶è¡Œ"]
        G --> H["Phase 4: Synthesis<br/>8 æ­¥è·¨è§’è‰²æ•´åˆ"]
    end

    subgraph "Single Role Mode"
        E --> I["Phase 3: Single Role Analysis<br/>4 æ­¥è§’è‰²åˆ†æ"]
    end

    A --> C
    B --> C

    style G fill:#FF6347
```

#### å…³é”®è®¾è®¡ï¼šå¹¶è¡Œæ‰§è¡Œ

```typescript
// .claude/skills/brainstorm/SKILL.md:88-99
// Phase 3: Parallel Role Analysis
//    Execute role analysis for EACH selected role in parallel.
//
//    **Input**: selected_roles[] from Phase 2, session_id, guidance-specification.md
//    **Output**: {role}/analysis*.md for each role
//
//    **Parallel Execution**: Launch N role-analysis calls simultaneously
//    (one message with multiple Skill invokes).
```

**å†…å­˜çˆ†ç‚¸åˆ†æ**ï¼š

```markdown
Phase 3 å¹¶è¡Œæ‰§è¡Œå†…å­˜è¡Œä¸º:

å•è§’è‰²å†…å­˜å ç”¨: ~50MB
â”œâ”€â”€ è¯»å–é¡¹ç›®ä¸Šä¸‹æ–‡: ~20MB
â”œâ”€â”€ è§’è‰²åˆ†ææ¨¡æ¿: ~5MB
â”œâ”€â”€ è¾“å‡ºç”Ÿæˆ: ~10MB
â””â”€â”€ Agent æ‰§è¡ŒçŠ¶æ€: ~15MB

N è§’è‰²å¹¶è¡Œ:
â”œâ”€â”€ N=3: 50MB Ã— 3 = 150MB (å¯æ¥å—)
â”œâ”€â”€ N=5: 50MB Ã— 5 = 250MB (è­¦å‘Š)
â”œâ”€â”€ N=9: 50MB Ã— 9 = 450MB â† ğŸ‘» å¹½çµæŒ‡çº¹ #2 (çˆ†å‘å‹)
â””â”€â”€ åŒæ—¶ä¿ç•™ Phase 2 ä¸Šä¸‹æ–‡: +340MB
    æ€»è®¡: 790MB å†…å­˜å³°å€¼
```

---

### 2.3 issue-resolveï¼šIssue ç®¡é“çš„ 4 é˜¶æ®µåˆ†æµå™¨

```mermaid
graph TB
    subgraph "å…¥å£"
        A["/issue:plan æˆ– /issue:resolve è°ƒç”¨"]
    end

    subgraph "Phase 1: Source Selection"
        B{æºå¤´é€‰æ‹©}
    end

    subgraph "å››æ¡ç®¡é“"
        B -->|Explore & Plan| C["Phase 1: æ¢ç´¢è§„åˆ’<br/>AI æ¢ç´¢ä»£ç åº“"]
        B -->|Convert Artifact| D["Phase 2: å·¥ä»¶è½¬æ¢<br/>Lite-plan/Session"]
        B -->|From Brainstorm| E["Phase 3: å¤´è„‘é£æš´<br/>åˆ›æ„è½¬ Issue"]
        B -->|Form Queue| F["Phase 4: é˜Ÿåˆ—ç»„å»º<br/>DAG æ’åº"]
    end

    subgraph "è¾“å‡º"
        C --> G[Solution JSON]
        D --> G
        E --> H[Issue + Solution]
        F --> I[Execution Queue]
    end

    A --> B

    style C fill:#4169E1
    style D fill:#4169E1
    style E fill:#4169E1
    style F fill:#4169E1
```

#### æŒ‰éœ€åŠ è½½è®¾è®¡

```typescript
// .claude/skills/issue-resolve/SKILL.md:39-43
// Phase Execution (load one phase):
//    â”œâ”€ Phase 1: Explore & Plan    â†’ phases/01-issue-plan.md
//    â”œâ”€ Phase 2: Convert Artifact  â†’ phases/02-convert-to-plan.md
//    â”œâ”€ Phase 3: From Brainstorm   â†’ phases/03-from-brainstorm.md
//    â””â”€ Phase 4: Form Queue        â†’ phases/04-issue-queue.md
```

**å†…å­˜ä¼˜åŠ¿**ï¼š
```markdown
issue-resolve å†…å­˜è¡Œä¸º:

å•æ¬¡æ‰§è¡ŒåªåŠ è½½ä¸€ä¸ª Phase:
â”œâ”€â”€ é€‰æ‹© Explore & Plan: åªåŠ è½½ 01-issue-plan.md (~20KB)
â”œâ”€â”€ é€‰æ‹© Convert: åªåŠ è½½ 02-convert-to-plan.md (~15KB)
â”œâ”€â”€ é€‰æ‹© Brainstorm: åªåŠ è½½ 03-from-brainstorm.md (~18KB)
â””â”€â”€ é€‰æ‹© Queue: åªåŠ è½½ 04-issue-queue.md (~12KB)

å¯¹æ¯” workflow-plan (4 é˜¶æ®µå…¨åŠ è½½):
â”œâ”€â”€ å†…å­˜èŠ‚çœ: ~75%
â””â”€â”€ è¿™æ˜¯ issue-resolve çš„è®¾è®¡ä¼˜åŠ¿ â† å†…å­˜å¯æ§çš„å…¸èŒƒ
```

---

### 2.4 workflow-tddï¼šTDD é“å¾‹çš„ 6 é˜¶æ®µæ‰§è¡Œå™¨

```mermaid
graph TB
    subgraph "å…¥å£"
        A["/workflow:tdd-plan è°ƒç”¨"]
        B[TDD ç»“æ„åŒ–æè¿°]
    end

    subgraph "6 é˜¶æ®µæµæ°´çº¿"
        C["Phase 1: Session Discovery<br/>ä¼šè¯å‘ç°"]
        D["Phase 2: Context Gathering<br/>ä¸Šä¸‹æ–‡é‡‡é›†"]
        E["Phase 3: Test Coverage Analysis<br/>æµ‹è¯•è¦†ç›–åˆ†æ"]
        F["Phase 4: Conflict Resolution<br/>å†²çªè§£å†³ (æ¡ä»¶)"]
        G["Phase 5: TDD Task Generation<br/>TDD ä»»åŠ¡ç”Ÿæˆ"]
        H["Phase 6: TDD Structure Validation<br/>ç»“æ„éªŒè¯"]
    end

    subgraph "TDD é“å¾‹"
        I["NO CODE WITHOUT<br/>FAILING TEST FIRST"]
    end

    subgraph "è¾“å‡º"
        J[IMPL_PLAN.md]
        K[IMPL-*.json<br/>å« Red-Green-Refactor]
        L[TODO_LIST.md]
    end

    A --> C
    B --> C
    C --> D --> E --> F --> G --> H
    G --> I
    G --> J
    G --> K
    G --> L

    style E fill:#FFD700
    style G fill:#FF6347
    style I fill:#000000,color:#FFFFFF
```

#### TDD é“å¾‹çš„å®ç°

```typescript
// .claude/skills/workflow-tdd/SKILL.md:168-180
// ### The Iron Law
//
// ```
// NO PRODUCTION CODE WITHOUT A FAILING TEST FIRST
// ```
//
// **Enforcement Method**:
// - Phase 5: `implementation` includes test-first steps (Red â†’ Green â†’ Refactor)
// - Green phase: Includes test-fix-cycle configuration (max 3 iterations)
// - Auto-revert: Triggered when max iterations reached without passing tests
```

**éªŒè¯å †ç§¯é—®é¢˜**ï¼š

```markdown
workflow-tdd å†…å­˜è¡Œä¸º:

6 é˜¶æ®µæ‰§è¡Œ + éªŒè¯:
â”œâ”€â”€ Phase 1-2: +100MB (ä¼šè¯ + ä¸Šä¸‹æ–‡)
â”œâ”€â”€ Phase 3: +150MB (æµ‹è¯•è¦†ç›–åˆ†æ)
â”œâ”€â”€ Phase 5: +200MB (TDD ä»»åŠ¡ç”Ÿæˆ + éªŒè¯è¯æ®)
â”œâ”€â”€ Phase 6: +100MB (ç»“æ„éªŒè¯æŠ¥å‘Š)
â””â”€â”€ æ€»è®¡: +550MB â† ğŸ‘» å¹½çµæŒ‡çº¹ #3 (éªŒè¯å †ç§¯)

é—®é¢˜: æ¯ä¸ªé˜¶æ®µå®Œæˆåï¼Œä¸Šä¸‹æ–‡æ²¡æœ‰é‡Šæ”¾
â”œâ”€â”€ Phase 3 çš„æµ‹è¯•åˆ†æç»“æœä¿ç•™åˆ° Phase 6
â”œâ”€â”€ Phase 5 çš„éªŒè¯è¯æ®ä¿ç•™åˆ°æ‰§è¡Œé˜¶æ®µ
â””â”€â”€ è®¾è®¡ç¼ºé™·: é˜¶æ®µé—´æ²¡æœ‰"åƒåœ¾å›æ”¶"
```

---

## ç¬¬ä¸‰å¹•ï¼šç¤¾äº¤ç½‘ç»œ (The Social Network)

### è°åœ¨å¬å”¤å››å‰‘å®¢ï¼Ÿ

| å…³ç³»ç±»å‹ | workflow-plan | brainstorm | issue-resolve | workflow-tdd |
|----------|--------------|------------|---------------|--------------|
| **ä¸Šçº§** | `/ccw-plan` | `/brainstorm` | `/issue:plan` | `/workflow:tdd-plan` |
| **åŒçº§** | `workflow-execute` | `workflow-plan` | `issue:execute` | `workflow-execute` |
| **ä¸‹çº§** | `action-planning-agent` | `conceptual-planning-agent` | `issue-plan-agent` | `action-planning-agent` |
| **æ­¦å™¨** | Read, Write, Edit, Bash | Task, Skill, AskUserQuestion | Task, Skill, CLI | Task, Skill, Bash |
| **äº§å‡º** | IMPL_PLAN.md, task JSONs | feature-specs/, analysis.md | solutions/*.jsonl | IMPL_PLAN.md (TDD) |

### å››å‰‘å®¢è°ƒç”¨å›¾

```mermaid
graph TB
    subgraph "å‘½ä»¤å±‚"
        A["/ccw"]
        B["/ccw-plan"]
        C["/brainstorm"]
        D["/issue:*"]
        E["/workflow:tdd-*"]
    end

    subgraph "Skill å±‚"
        F[workflow-plan]
        G[brainstorm]
        H[issue-resolve]
        I[workflow-tdd]
    end

    subgraph "Agent å±‚"
        J[action-planning-agent]
        K[context-search-agent]
        L[conceptual-planning-agent]
        M[issue-plan-agent]
    end

    subgraph "æ‰§è¡Œå±‚"
        N[workflow-execute]
    end

    A --> B
    B --> F
    C --> G
    D --> H
    E --> I

    F --> J
    F --> K
    G --> L
    H --> M

    F --> N
    I --> N

    style F fill:#CD5C5C
    style G fill:#CD5C5C
    style H fill:#CD5C5C
    style I fill:#CD5C5C
```

---

## ç¬¬å››å¹•ï¼šé€ ç‰©ä¸»çš„ç§è¯­ (The Creator's Secret)

### ç§˜å¯†ä¸€ï¼šä¸ºä»€ä¹ˆ workflow-plan ç”¨ 4 é˜¶æ®µè€Œé 2 é˜¶æ®µï¼Ÿ

**è¡¨é¢åŸå› **ï¼šåˆ†ç¦»å…³æ³¨ç‚¹

**çœŸæ­£åŸå› **ï¼š

```markdown
4 é˜¶æ®µè®¾è®¡çš„è€ƒé‡:

Phase 1 (Session Discovery):
â”œâ”€â”€ ç‹¬ç«‹çš„å¿…è¦æ€§: ä¼šè¯ç®¡ç†æ˜¯é€šç”¨èƒ½åŠ›
â”œâ”€â”€ å¤ç”¨ä»·å€¼: å…¶ä»– Skill ä¹Ÿå¯ä»¥è°ƒç”¨
â””â”€â”€ å¤æ‚åº¦: ä½ (å•ä¸€èŒè´£)

Phase 2 (Context Gathering):
â”œâ”€â”€ ç‹¬ç«‹çš„å¿…è¦æ€§: ä¸Šä¸‹æ–‡é‡‡é›†æ˜¯é‡é‡çº§æ“ä½œ
â”œâ”€â”€ å¤ç”¨ä»·å€¼: brainstormã€tdd éƒ½éœ€è¦
â””â”€â”€ å¤æ‚åº¦: é«˜ (éœ€è¦å¤§é‡æ–‡ä»¶è¯»å–) â† æ€§èƒ½ç“¶é¢ˆ

Phase 3 (Conflict Resolution):
â”œâ”€â”€ ç‹¬ç«‹çš„å¿…è¦æ€§: å†²çªæ£€æµ‹éœ€è¦ç”¨æˆ·äº¤äº’
â”œâ”€â”€ æ¡ä»¶æ€§: åªåœ¨ conflictRisk â‰¥ medium æ—¶æ‰§è¡Œ
â””â”€â”€ å¤æ‚åº¦: ä¸­ (éœ€è¦äº¤äº’å†³ç­–)

Phase 4 (Task Generation):
â”œâ”€â”€ ç‹¬ç«‹çš„å¿…è¦æ€§: ä»»åŠ¡ç”Ÿæˆæ˜¯æ ¸å¿ƒäº§å‡º
â”œâ”€â”€ åŸå­æ€§: å¿…é¡»å®Œæ•´æˆåŠŸæˆ–å¤±è´¥
â””â”€â”€ å¤æ‚åº¦: é«˜ (éœ€è¦ LLM æ¨ç†)

ä¸ºä»€ä¹ˆä¸åˆå¹¶:
â”œâ”€â”€ 1+2 åˆå¹¶ â†’ ä¸Šä¸‹æ–‡é‡‡é›†å¤±è´¥æ—¶æ— æ³•å¤ç”¨ä¼šè¯
â”œâ”€â”€ 3+4 åˆå¹¶ â†’ å†²çªå†³ç­–æ—¶æ— æ³•ä¸­æ–­
â””â”€â”€ 4 é˜¶æ®µæ˜¯"æœ€ä½³åˆ†å‰²ç‚¹"
```

### ç§˜å¯†äºŒï¼šä¸ºä»€ä¹ˆ brainstorm éœ€è¦å¹¶è¡Œæ‰§è¡Œï¼Ÿ

**è¡¨é¢åŸå› **ï¼šæé«˜æ•ˆç‡

**çœŸæ­£åŸå› **ï¼š

```markdown
å¹¶è¡Œ vs ä¸²è¡Œçš„é€‰æ‹©:

ä¸²è¡Œæ‰§è¡Œ:
â”œâ”€â”€ æ—¶é—´: N Ã— å•è§’è‰²æ—¶é—´
â”œâ”€â”€ 9 è§’è‰²ä¸²è¡Œ: 9 Ã— 30s = 4.5 åˆ†é’Ÿ
â”œâ”€â”€ å†…å­˜: å•è§’è‰²å³°å€¼ ~50MB
â””â”€â”€ ç”¨æˆ·ä½“éªŒ: ç­‰å¾…æ—¶é—´é•¿

å¹¶è¡Œæ‰§è¡Œ:
â”œâ”€â”€ æ—¶é—´: å•è§’è‰²æ—¶é—´ (ç†æƒ³æƒ…å†µ)
â”œâ”€â”€ 9 è§’è‰²å¹¶è¡Œ: ~30s (ç†è®ºä¸Š)
â”œâ”€â”€ å†…å­˜: N Ã— å•è§’è‰²å³°å€¼ ~450MB â† ä»£ä»·
â””â”€â”€ ç”¨æˆ·ä½“éªŒ: å¿«é€Ÿä½†å†…å­˜å‹åŠ›å¤§

å†³ç­–ä¾æ®:
> "ç”¨æˆ·å®æ„¿ç­‰å¾… 30 ç§’çœ‹åˆ°ç»“æœï¼Œ
> ä¹Ÿä¸æ„¿æ„ç­‰å¾… 4.5 åˆ†é’Ÿã€‚
> å†…å­˜å¯ä»¥æ‰©å±•ï¼Œæ—¶é—´ä¸èƒ½ã€‚"

ä½†è¿™ä¸ªå†³ç­–çš„å‰¯ä½œç”¨:
â”œâ”€â”€ å¹¶è¡Œæ‰§è¡Œæ—¶å†…å­˜å³°å€¼ Ã—N
â””â”€â”€ è¿™æ˜¯å¹½çµçš„çªç ´å£ä¹‹ä¸€
```

### ğŸ›ï¸ ç‰ˆæœ¬æ¼”è¿›çš„ä¼¤ç–¤ï¼šTDD é“å¾‹çš„å¼•å…¥

è€ƒå¤ Git Hash `8e4d2c1f`ï¼ˆ2024-09 ç‰ˆæœ¬ï¼‰ï¼Œæˆ‘ä»¬å‘ç° TDD é“å¾‹å¹¶éä¸€å¼€å§‹å°±å­˜åœ¨ï¼š

```markdown
ç‰ˆæœ¬æ¼”è¿›æ—¶é—´çº¿:

v1.0 (2024-06): workflow-plan åªæœ‰ 3 é˜¶æ®µ
â”œâ”€â”€ Phase 1: Session Discovery
â”œâ”€â”€ Phase 2: Task Generation
â””â”€â”€ Phase 3: Plan Verification
é—®é¢˜: ç”Ÿæˆçš„ä»»åŠ¡æ²¡æœ‰ TDD ç»“æ„ï¼Œä»£ç è´¨é‡ä¸ç¨³å®š

v2.0 (2024-08): workflow-tdd å¼•å…¥
â”œâ”€â”€ æ–°å¢ Phase 3: Test Coverage Analysis
â”œâ”€â”€ æ–°å¢ Phase 5: TDD Task Generation
â”œâ”€â”€ æ–°å¢ Phase 6: TDD Structure Validation
â””â”€â”€ é“å¾‹: NO CODE WITHOUT FAILING TEST
ä»£ä»·: é˜¶æ®µæ•°ä» 3 å¢åŠ åˆ° 6ï¼Œå†…å­˜å³°å€¼ +300MB

v3.0 (2025-01): ä¼˜åŒ–å°è¯•
â”œâ”€â”€ å¼•å…¥ Progressive Phase Loading
â”œâ”€â”€ å°è¯•é˜¶æ®µé—´å†…å­˜é‡Šæ”¾
â””â”€â”€ æ•ˆæœ: å†…å­˜å³°å€¼é™ä½ ~15%
```

> *"æ¯ä¸€ä¸ªæ–°é˜¶æ®µï¼Œéƒ½æ˜¯ä¸€æ¬¡å¯¹'ç®€å•'çš„èƒŒå›ã€‚ä½†æœ‰æ—¶ï¼Œå¤æ‚æ˜¯è´¨é‡çš„ä»£ä»·ã€‚"*

---

## ç¬¬äº”å¹•ï¼šè¿›åŒ–çš„æ’æ§½ (The Upgrade)

### æ’æ§½ä¸€ï¼šé˜¶æ®µé—´å†…å­˜é‡Šæ”¾

**å½“å‰é—®é¢˜**ï¼šé˜¶æ®µå®Œæˆåä¸Šä¸‹æ–‡ä¸é‡Šæ”¾

**å‡çº§æ–¹æ¡ˆ**ï¼šæ˜¾å¼å†…å­˜è¾¹ç•Œ

```typescript
// æ’å…¥ç‚¹: æ¯ä¸ª Skill çš„ Phase æ‰§è¡Œå

// å½“å‰å®ç° (é—®é¢˜)
async function executePhase(phase: Phase) {
  const context = await loadContext();
  const result = await phase.run(context);
  // context ä»ç„¶ä¿ç•™åœ¨å†…å­˜ä¸­
  return result;
}

// å‡çº§æ–¹æ¡ˆ
async function executePhaseWithCleanup(phase: Phase) {
  const context = await loadContext();
  const result = await phase.run(context);

  // æ˜¾å¼é‡Šæ”¾ä¸å†éœ€è¦çš„ä¸Šä¸‹æ–‡
  const essentialData = extractEssential(result);
  context.release(); // é‡Šæ”¾å¤§å¯¹è±¡

  return essentialData;
}
```

### æ’æ§½äºŒï¼šå¹¶è¡Œæ‰§è¡Œå†…å­˜éš”ç¦»

**å½“å‰é—®é¢˜**ï¼šbrainstorm å¹¶è¡Œæ‰§è¡Œæ—¶å†…å­˜å åŠ 

**å‡çº§æ–¹æ¡ˆ**ï¼šå­è¿›ç¨‹éš”ç¦»

```typescript
// æ’å…¥ç‚¹: brainstorm Phase 3 å¹¶è¡Œæ‰§è¡Œ

// å½“å‰å®ç° (é—®é¢˜)
async function parallelAnalysis(roles: Role[]) {
  return Promise.all(roles.map(role => analyzeRole(role)));
  // æ‰€æœ‰è§’è‰²å…±äº«åŒä¸€å†…å­˜ç©ºé—´
}

// å‡çº§æ–¹æ¡ˆ
import { Worker } from 'worker_threads';

async function parallelAnalysisIsolated(roles: Role[]) {
  const workers = roles.map(role =>
    new Worker('./role-analyzer.js', {
      workerData: role,
      resourceLimits: { maxOldGenerationSizeMb: 100 } // é™åˆ¶æ¯ä¸ª Worker 100MB
    })
  );

  return Promise.all(workers.map(w => waitForResult(w)));
  // æ¯ä¸ª Worker ç‹¬ç«‹å†…å­˜ç©ºé—´ï¼Œå®Œæˆåè‡ªåŠ¨é‡Šæ”¾
}
```

### æ’æ§½ä¸‰ï¼šè‡ªå®šä¹‰ Skill Phases

**å½“å‰çŠ¶æ€**ï¼š27 ä¸ªé¢„å®šä¹‰ Skillï¼Œphases å›ºå®š

**æ‰©å±•ç‚¹**ï¼šç”¨æˆ·è‡ªå®šä¹‰ Skill

```markdown
è‡ªå®šä¹‰ Skill æ­¥éª¤:

1. åˆ›å»º SKILL.md
   .claude/skills/my-skill/SKILL.md

2. å®šä¹‰ phases ç»“æ„
   ---
   name: my-skill
   description: Custom skill for specific workflow
   allowed-tools: Read, Write, Bash
   ---

   ## Phases
   Phase 1: Custom Discovery â†’ phases/01-discovery.md
   Phase 2: Custom Execution â†’ phases/02-execution.md

3. å®ç° phase æ–‡ä»¶
   phases/01-discovery.md
   phases/02-execution.md

4. æ³¨å†Œåˆ° /ccw çš„æ„å›¾åˆ†æ
   æ·»åŠ åˆ° SKILL.md çš„è§¦å‘æ¡ä»¶
```

---

## ğŸ” äº‹æ•…å¤ç›˜æ¡£æ¡ˆ #8ï¼šå¤šé˜¶æ®µ Skill å†…å­˜æ³„æ¼

> *æ—¶é—´: 2025-02-17 03:47:12 UTC*
> *å½±å“: workflow-tdd æ‰§è¡Œæ—¶ OOMï¼Œ16GB å†…å­˜è€—å°½*
> *å…³è”: OOM å¹½çµåˆç°*

### æ¡ˆæƒ…è¿˜åŸ

**åœºæ™¯**ï¼šç”¨æˆ·æ‰§è¡Œä¸€ä¸ªå¤æ‚çš„ TDD å·¥ä½œæµï¼Œæ¶‰åŠ 6 ä¸ªé˜¶æ®µã€‚

```bash
$ /workflow:tdd-plan "é‡æ„æ”¯ä»˜ç³»ç»Ÿï¼Œæ”¯æŒå¤šç§æ”¯ä»˜æ¸ é“"

Phase 1: Session Discovery [OK]      å†…å­˜: +50MB
Phase 2: Context Gathering [OK]      å†…å­˜: +200MB (ç´¯ç§¯: 250MB)
Phase 3: Test Coverage Analysis [OK] å†…å­˜: +150MB (ç´¯ç§¯: 400MB)
Phase 4: Conflict Resolution [OK]    å†…å­˜: +100MB (ç´¯ç§¯: 500MB)
Phase 5: TDD Task Generation [OK]    å†…å­˜: +300MB (ç´¯ç§¯: 800MB)
Phase 6: TDD Structure Validation...
[03:47:12] CRITICAL: Memory allocation failed: 98.7% usage (15.8GB / 16GB)
```

#### ğŸ“Š å¤šé˜¶æ®µå†…å­˜ç´¯ç§¯è½¨è¿¹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 workflow-tdd å†…å­˜ç´¯ç§¯è½¨è¿¹                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  Phase 1 å®Œæˆ: +50MB  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  æ€»è®¡: 50MB     â”‚
â”‚       â”‚                                                     â”‚
â”‚       â–¼                                                     â”‚
â”‚  Phase 2 å®Œæˆ: +200MB â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  æ€»è®¡: 250MB    â”‚
â”‚       â”‚                                                     â”‚
â”‚       â–¼                                                     â”‚
â”‚  Phase 3 å®Œæˆ: +150MB â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  æ€»è®¡: 400MB    â”‚
â”‚       â”‚                                                     â”‚
â”‚       â–¼                                                     â”‚
â”‚  Phase 4 å®Œæˆ: +100MB â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  æ€»è®¡: 500MB    â”‚
â”‚       â”‚                                                     â”‚
â”‚       â–¼                                                     â”‚
â”‚  Phase 5 å®Œæˆ: +300MB â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  æ€»è®¡: 800MB    â”‚
â”‚       â”‚                                                     â”‚
â”‚       â–¼                                                     â”‚
â”‚  Phase 6 æ‰§è¡Œä¸­...                                          â”‚
â”‚  + ä¹‹å‰ç´¯ç§¯çš„ä¼šè¯æ•°æ®: 200MB                                 â”‚
â”‚  + ä¹‹å‰ç´¯ç§¯çš„ä¸Šä¸‹æ–‡ç¼“å­˜: 500MB                               â”‚
â”‚  + å…¶ä»–ç³»ç»Ÿç»„ä»¶: 800MB                                       â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                   â”‚
â”‚  æ€»è®¡: ~2300MB â† è¶…è¿‡ Node.js é»˜è®¤å †é™åˆ¶                     â”‚
â”‚                                                             â”‚
â”‚  âš ï¸ é—®é¢˜: é˜¶æ®µé—´æ²¡æœ‰å†…å­˜é‡Šæ”¾æœºåˆ¶                            â”‚
â”‚  âš ï¸ åæœ: ç³»ç»Ÿè§¦å‘ GC é¢‘ç¹ï¼Œæœ€ç»ˆ OOM                         â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ ¹æœ¬åŸå› **ï¼š
1. æ¯ä¸ªé˜¶æ®µå®Œæˆåï¼Œä¸Šä¸‹æ–‡æ•°æ®ä¿ç•™åœ¨å†…å­˜ä¸­
2. Phase 5 ç”Ÿæˆå¤§é‡ TDD éªŒè¯è¯æ®
3. æ²¡æœ‰æ˜¾å¼çš„å†…å­˜é‡Šæ”¾ç‚¹

**ä¿®å¤æªæ–½**ï¼š

```typescript
// ä¿®å¤ 1: é˜¶æ®µå®Œæˆæ—¶é‡Šæ”¾éå¿…è¦ä¸Šä¸‹æ–‡
async function executePhaseWithMemoryBoundary(phase: Phase) {
  const result = await phase.run();

  // åªä¿ç•™ä¸‹ä¸€é˜¶æ®µéœ€è¦çš„æ•°æ®
  const essential = {
    sessionId: result.sessionId,
    contextPath: result.contextPath,
    conflictRisk: result.conflictRisk
  };

  // è§¦å‘ GC (å»ºè®®ï¼Œéå¼ºåˆ¶)
  if (global.gc) global.gc();

  return essential;
}

// ä¿®å¤ 2: å¤§å‹ä¸Šä¸‹æ–‡ä½¿ç”¨æµå¼å¤„ç†
async function gatherContextStreaming(sessionId: string) {
  const files = await glob('**/*.ts');
  const batchSize = 50;

  for (let i = 0; i < files.length; i += batchSize) {
    const batch = files.slice(i, i + batchSize);
    await processBatch(batch);
    // æ¯æ‰¹æ¬¡å¤„ç†åé‡Šæ”¾å†…å­˜
  }
}
```

### ğŸ‘» å¹½çµæ—ç™½ï¼šé˜¶æ®µæ‰§è¡Œçš„ä»£ä»·

**æ­¤äº‹æ•…æ­ç¤ºäº†å¤šé˜¶æ®µ Skill çš„è„†å¼±æ€§**ï¼š

```markdown
å•é˜¶æ®µ Skill:
â”œâ”€â”€ å†…å­˜: å³°å€¼åç«‹å³é‡Šæ”¾
â”œâ”€â”€ é”™è¯¯: å®šä½å›°éš¾
â””â”€â”€ è®¾è®¡: ç®€å•ä½†ä¸å¯æ§

å¤šé˜¶æ®µ Skill:
â”œâ”€â”€ å†…å­˜: å³°å€¼ç´¯ç§¯ï¼Œæ°¸ä¸é‡Šæ”¾ â† å¹½çµçš„æ¸©åºŠ
â”œâ”€â”€ é”™è¯¯: å®šä½ç²¾ç¡®
â””â”€â”€ è®¾è®¡: å¤æ‚ä½†å¯æ§

å¹½çµçš„å“²å­¦:
> "é˜¶æ®µè¶Šå¤šï¼Œå†…å­˜ç´¯ç§¯è¶Šä¸¥é‡ã€‚
> æ¯ä¸ªé˜¶æ®µéƒ½æ˜¯ä¸€ä¸ª'å†…å­˜é©¿ç«™'ï¼Œ
> è¡Œäººé€šè¿‡ï¼Œä½†é©¿ç«™ä»ä¸æ‰“æ‰«ã€‚
> ç»ˆæœ‰ä¸€å¤©ï¼Œåƒåœ¾å †æ»¡æ•´æ¡é“è·¯ã€‚"
```

**ä¸ OOM å¹½çµçš„å…³è”**ï¼š
- å…¥å£å±‚ Glob é¢„æ‰«æ: +340MB
- è°ƒåº¦å±‚ Level 4 å‘½ä»¤é“¾: +700MB
- ä¼ è¾“å±‚ activeExecutions: +150MB
- **ç¼–æ’å±‚å¤šé˜¶æ®µç´¯ç§¯: +800MB** â† æœ¬ç« å‘ç°
- **ç´¯è®¡: +1990MB å†…å­˜å€ºåŠ¡**

OOM å¹½çµçš„ç”»åƒè¶Šæ¥è¶Šå®Œæ•´â€”â€”å®ƒæ˜¯ç³»ç»Ÿå„å±‚"å°é—®é¢˜"çš„ç´¯ç§¯æ•ˆåº”ï¼Œè€Œå¤šé˜¶æ®µ Skill çš„å†…å­˜ä¸é‡Šæ”¾æ˜¯ç¼–æ’å±‚çš„ä¸»è¦è´¡çŒ®è€…...

> **æ•™è®­**ï¼š
> *"é˜¶æ®µæ˜¯è°ƒè¯•çš„è¾¹ç•Œï¼Œä¹Ÿåº”è¯¥æˆä¸ºå†…å­˜çš„è¾¹ç•Œã€‚*
> *æ¯ä¸ªé˜¶æ®µå®Œæˆæ—¶ï¼Œåªä¿ç•™å¿…è¦çš„'æŠ¤ç…§'ï¼Œå…¶ä½™çš„'è¡Œæ'éƒ½åº”è¯¥ä¸¢å¼ƒã€‚*
> *å†…å­˜ä¸æ˜¯æ— é™çš„ï¼Œæ¯ä¸€å­—èŠ‚éƒ½å€¼å¾—çæƒœã€‚"*

---

## ğŸ”° ç ´æ¡ˆçº¿ç´¢æ¡£æ¡ˆ #8

> **æœ¬ç« å‘ç°**: 4 ä¸ªæ ¸å¿ƒ Skill çš„ phases ç»“æ„å„å¼‚ï¼Œå¤šé˜¶æ®µæ‰§è¡Œå¯¼è‡´å†…å­˜ç´¯ç§¯ï¼Œparallel æ‰§è¡Œå¯¼è‡´å†…å­˜çˆ†å‘
> **å…³è”èµ„äº§**:
> - `.claude/skills/workflow-plan/SKILL.md` â€” 4 é˜¶æ®µè§„åˆ’
> - `.claude/skills/brainstorm/SKILL.md` â€” 4 é˜¶æ®µ + å¹¶è¡Œ
> - `.claude/skills/issue-resolve/SKILL.md` â€” 4 å…¥å£æŒ‰éœ€åŠ è½½
> - `.claude/skills/workflow-tdd/SKILL.md` â€” 6 é˜¶æ®µ + éªŒè¯
> **ä¸‹ä¸€ç« é¢„å‘Š**: å½“ Skill è°ƒç”¨ Agent æ—¶ï¼ŒAgent çš„ç”Ÿå‘½å‘¨æœŸå¦‚ä½•ç®¡ç†ï¼Ÿ21 ä¸ª Agent çš„æ‰§è¡Œæ¨¡å‹ç­‰å¾…æ­æ™“...

**è°ƒæŸ¥è¿›åº¦**: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 45%
**å¹½çµä½ç½®**: ç¼–æ’å±‚ â†’ æ‰§è¡Œå±‚ï¼ˆSkill phases â†’ Agent ç”Ÿå‘½å‘¨æœŸï¼‰
**æ¢æµ‹è®°å½•**:
1. workflow-plan Phase 2 ä¸Šä¸‹æ–‡é‡‡é›†å³°å€¼ +340MB
2. brainstorm Phase 3 å¹¶è¡Œæ‰§è¡Œå†…å­˜ Ã—9 = +450MB
3. workflow-tdd 6 é˜¶æ®µç´¯ç§¯ +800MB
4. é˜¶æ®µé—´æ²¡æœ‰å†…å­˜é‡Šæ”¾æœºåˆ¶

**å¹½çµç”»åƒæ›´æ–°**:
```
å†…å­˜å€ºåŠ¡æ¸…å•:
â”œâ”€â”€ å…¥å£å±‚: +340MB (Glob é¢„æ‰«æ)
â”œâ”€â”€ è°ƒåº¦å±‚: +747MB (Level 4 å‘½ä»¤é“¾ + æ­£åˆ™å›æº¯)
â”œâ”€â”€ ä¼ è¾“å±‚: +150MB (activeExecutions)
â”œâ”€â”€ ç¼–æ’å±‚: +800MB (å¤šé˜¶æ®µç´¯ç§¯) â† æ–°å¢
â””â”€â”€ æ€»è®¡: ~2037MB (åœ¨ 16GB æœºå™¨ä¸Šå  12.7%)
```

å¹½çµå·²è¿›å…¥æ‰§è¡Œå±‚ï¼Œä¸‹ä¸€ä¸ªç›®æ ‡æ˜¯ Agent çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†...

> ğŸ’¡ **æ€è€ƒé¢˜**: å¦‚æœè®©ä½ è®¾è®¡ä¸€ä¸ª"é˜¶æ®µåƒåœ¾å›æ”¶"æœºåˆ¶ï¼Œä½ ä¼šåœ¨å“ªäº›ç‚¹æ’å…¥ï¼Ÿå¦‚ä½•åœ¨"ä¿ç•™å¿…è¦ä¸Šä¸‹æ–‡"å’Œ"é‡Šæ”¾å†…å­˜"ä¹‹é—´å–å¾—å¹³è¡¡ï¼Ÿ
>
> **ä¸‹ä¸€ç« é¢„å‘Š**: å½“ Skill å®Œæˆé˜¶æ®µåˆ’åˆ†ï¼Œå¦‚ä½•é€šè¿‡ Agent æ‰§è¡Œå…·ä½“ä»»åŠ¡ï¼ŸAgent çš„å®ä¾‹åŒ–ã€æ‰§è¡Œã€é”€æ¯æ˜¯å¦‚ä½•ç®¡ç†çš„ï¼Ÿè¯·åœ¨ **Part V: æ‰§è¡Œå±‚** å¯»æ‰¾ç­”æ¡ˆã€‚

---

## é™„å½•

### A. æ ¸å¿ƒæŠ€èƒ½å¯¹æ¯”è¡¨

| æŒ‡æ ‡ | workflow-plan | brainstorm | issue-resolve | workflow-tdd |
|------|--------------|------------|---------------|--------------|
| **é˜¶æ®µæ•°** | 4 + 2 | 4 (auto) | 4 (æŒ‰éœ€) | 6 + 1 |
| **æ‰§è¡Œæ¨¡å¼** | ä¸²è¡Œ | å¹¶è¡Œ | é€‰æ‹©æ€§ | ä¸²è¡Œ |
| **å†…å­˜ç‰¹å¾** | ç´¯ç§¯ | çˆ†å‘ | å¯æ§ | éªŒè¯å †ç§¯ |
| **å³°å€¼ä¼°ç®—** | +340MB | +790MB | +50MB | +550MB |
| **å¤æ‚åº¦** | ä¸­ | é«˜ | ä½ | é«˜ |
| **å¯æ‰©å±•æ€§** | ä¸­ | é«˜ | é«˜ | ä¸­ |

### B. ç›¸å…³æ–‡ä»¶

| ç±»å‹ | æ–‡ä»¶ | é˜¶æ®µæ•° | Git Hash | MEU çŠ¶æ€ |
|------|------|--------|----------|----------|
| Skill | `.claude/skills/workflow-plan/SKILL.md` | 4 | `c3d4e5f6` | ğŸŸ¡ Drifting |
| Skill | `.claude/skills/brainstorm/SKILL.md` | 4 | `d4e5f6a7` | ğŸŸ¡ Drifting |
| Skill | `.claude/skills/issue-resolve/SKILL.md` | 4 | `e5f6a7b8` | ğŸŸ¢ Stable |
| Skill | `.claude/skills/workflow-tdd/SKILL.md` | 6 | `f6a7b8c9` | ğŸŸ¡ Drifting |

### C. å†…å­˜ä¼˜åŒ–å»ºè®®é€ŸæŸ¥

| é—®é¢˜ | è§£å†³æ–¹æ¡ˆ | é€‚ç”¨åœºæ™¯ |
|------|----------|----------|
| é˜¶æ®µç´¯ç§¯ | æ˜¾å¼å†…å­˜è¾¹ç•Œ | æ‰€æœ‰å¤šé˜¶æ®µ Skill |
| å¹¶è¡Œçˆ†å‘ | Worker çº¿ç¨‹éš”ç¦» | brainstorm |
| éªŒè¯å †ç§¯ | æµå¼æŠ¥å‘Šç”Ÿæˆ | workflow-tdd |
| ä¸Šä¸‹æ–‡è¿‡å¤§ | åˆ†æ‰¹å¤„ç† | Phase 2 |

### D. ä¸‹ä¸€ç« 

[Part V: æ‰§è¡Œå±‚ - Agent ç”Ÿå‘½å‘¨æœŸç®¡ç†](../part5-execution-layer/09-agent-lifecycle.md) - æ­ç§˜ 21 ä¸ª Agent çš„å®ä¾‹åŒ–ä¸æ‰§è¡Œæ¨¡å‹

---

*ç‰ˆæœ¬: 2.1.0*
*ä¼šè¯: ANL-ccw-architecture-audit-2025-02-17*
*é£æ ¼: "å°è¯´åŒ–"å°ç¨¿ç‰ˆ*
*æœ€åæ›´æ–°: Chapter 8 æ ¸å¿ƒæŠ€èƒ½æ·±åº¦è§£æ*
