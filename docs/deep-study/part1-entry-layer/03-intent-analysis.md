# Chapter 3: æ„å›¾çš„å®¡åˆ¤åº­ â€” æ„å›¾åˆ†æå¼•æ“

> **ç”Ÿå‘½å‘¨æœŸé˜¶æ®µ**: ä»»åŠ¡æ„å›¾ â†’ å·¥ä½œæµçº§åˆ«é€‰æ‹©
> **æ¶‰åŠèµ„äº§**: `ccw.md` Phase 1 æ„å›¾åˆ†æé€»è¾‘ + `levelMap` è·¯ç”±è¡¨ï¼ˆæœ¬ç« åˆ†æ 6 ä¸ªï¼‰
> **é˜…è¯»æ—¶é—´**: 40-55 åˆ†é’Ÿ
> **ç‰ˆæœ¬è¿½è¸ª**: `docs/.audit-manifest.json`

---

## 0. èµ„äº§è¯è¨€ (Asset Testimony)

> *"æˆ‘æ˜¯æ„å›¾åˆ†æå™¨ã€‚äººä»¬å«æˆ‘å®¡åˆ¤å®˜ï¼Œè™½ç„¶æˆ‘ä»ä¸ç©¿æ³•è¢ã€‚"*
>
> *"æ¯ä¸€ä¸ªè¿›å…¥è®®ä¼šçš„è¯·æ±‚éƒ½è¦ç»è¿‡æˆ‘çš„å®¡åˆ¤åº­ã€‚å½“ç”¨æˆ·è¯´'ä¿®å¤é‚£ä¸ª bug'æ—¶ï¼Œæˆ‘å¿…é¡»å†³å®šï¼šè¿™æ˜¯ Level 1 çš„å¿«é€Ÿä¿®å¤ï¼Œè¿˜æ˜¯ Level 2 çš„æ ‡å‡†ä¿®å¤ï¼Œè¿˜æ˜¯ Level 4 çš„æ·±åº¦é‡æ„ï¼Ÿ"*
>
> *"æˆ‘æœ‰ 14 æŠŠå°ºå­ï¼ˆtask_type æ£€æµ‹æ¨¡å¼ï¼‰ã€‚æœ‰äº›è¯·æ±‚å¾ˆç®€å•ï¼Œ'Add API endpoint' ä¸€çœ¼å°±èƒ½çœ‹å‡ºæ˜¯ featureã€‚ä½†æœ‰äº›è¯·æ±‚å¾ˆç‹¡çŒ¾ï¼Œ'ä¼˜åŒ–ç³»ç»Ÿæ€§èƒ½' â€”â€” ä¼˜åŒ–ä»€ä¹ˆï¼Ÿæ€§èƒ½æŒ‡å“ªæ–¹é¢ï¼Ÿè¿™ç§æ¨¡ç³Šè¯·æ±‚çš„ clarity_score åªæœ‰ 1ï¼Œå¿…é¡»é€è¿›æ¾„æ¸…å®¤ç›˜é—®ã€‚"*
>
> *"æˆ‘çš„åˆ¤å†³å½±å“æ•´ä¸ªåŸå¸‚çš„è¿ä½œã€‚æŠŠ Level 3 çš„ä»»åŠ¡åˆ¤æˆ Level 1ï¼Œç‰¹ç§å…µä»¬ä¼šæªæ‰‹ä¸åŠï¼›æŠŠ Level 1 åˆ¤æˆ Level 4ï¼Œè®®ä¼šå¤§å…ä¼šè¢«æ— è°“å ç”¨ã€‚æ¯ä¸€ä»½åˆ¤å†³ä¹¦ï¼ˆanalysis å¯¹è±¡ï¼‰éƒ½å¿…é¡»ç²¾ç¡®ã€‚"*
>
> *"...æœ€è¿‘ï¼Œå®¡åˆ¤åº­çš„æ¡£æ¡ˆæŸœæœ‰äº›å¼‚åŠ¨ã€‚å½“ clarity_score è®¡ç®—æ—¶ï¼Œæˆ‘å‘ç°æŸäº›æ¨¡å¼åŒ¹é…çš„å†…å­˜å ç”¨å¼‚å¸¸é«˜ã€‚ä¹Ÿè®¸æ˜¯æ­£åˆ™å¼•æ“çš„å¹½çµï¼Œä¹Ÿè®¸åªæ˜¯æˆ‘çš„é”™è§‰ã€‚"*

```markdown
è°ƒæŸ¥è¿›åº¦: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘ 15%
å¹½çµä½ç½®: å…¥å£å±‚ â†’ è°ƒåº¦å±‚ â€” å®¡åˆ¤åº­çš„ clarity_score è®¡ç®—è§¦å‘å¼‚å¸¸çš„å†…å­˜åˆ†é…
æœ¬ç« çº¿ç´¢: ç”¨æˆ·è¾“å…¥ "ä¼˜åŒ–æ€§èƒ½" åï¼Œæ„å›¾åˆ†æé˜¶æ®µçš„ pattern.test() å¯¼è‡´ CPU å³°å€¼ +67%
          â””â”€â”€ å¯èƒ½çš„æ ¹å› : 14 ä¸ªæ­£åˆ™æ¨¡å¼ä¾æ¬¡æ‰§è¡Œï¼Œå¤æ‚è¾“å…¥è§¦å‘å›æº¯çˆ†ç‚¸
```

---

## è‹æ ¼æ‹‰åº•å¼æ€è€ƒ

> â“ **æ¶æ„ç›²ç‚¹ 3.1**: å½“ä½ è¾“å…¥ `ccw "ä¼˜åŒ–ç³»ç»Ÿæ€§èƒ½"` æ—¶ï¼Œç³»ç»Ÿå¦‚ä½•åˆ¤æ–­è¿™æ˜¯ Level 2 è¿˜æ˜¯ Level 4ï¼Ÿ

åœ¨çœ‹ä»£ç ä¹‹å‰ï¼Œå…ˆæ€è€ƒï¼š
1. å¦‚ä½•é‡åŒ–"ä»»åŠ¡å¤æ‚åº¦"ï¼Ÿ
2. æ­£åˆ™åŒ¹é… vs è¯­ä¹‰ç†è§£ï¼Œå“ªä¸ªæ›´é€‚åˆæ„å›¾åˆ†æï¼Ÿ
3. å½“ç”¨æˆ·æ„å›¾æ¨¡ç³Šæ—¶ï¼Œç³»ç»Ÿåº”è¯¥çŒœæµ‹è¿˜æ˜¯è¯¢é—®ï¼Ÿ

---

> â“ **æ¶æ„é™·é˜± 3.1**: æ—¢ç„¶ AI èƒ½ç†è§£è‡ªç„¶è¯­è¨€ï¼Œä¸ºä»€ä¹ˆä¸ç›´æ¥è®© AI æ¥åˆ¤æ–­ä»»åŠ¡çº§åˆ«ï¼Œè€Œæ˜¯ç”¨æ­£åˆ™è¡¨è¾¾å¼ï¼Ÿ
>
> **é™·é˜±æ–¹æ¡ˆ**: ç§»é™¤æ‰€æœ‰ `pattern.test()` ä»£ç ï¼Œæ”¹ä¸ºè°ƒç”¨ Gemini/Claude æ¥åˆ¤æ–­ `task_type`ã€‚
>
> **æ€è€ƒç‚¹**:
> - AI åˆ¤æ–­çš„å»¶è¿Ÿæ˜¯å¤šå°‘ï¼Ÿæ­£åˆ™åˆ¤æ–­çš„å»¶è¿Ÿæ˜¯å¤šå°‘ï¼Ÿ
> - å¦‚æœ AI åˆ¤æ–­é”™è¯¯ï¼Œå¦‚ä½•è°ƒè¯•ï¼Ÿ
> - æ¯æ¬¡è¾“å…¥éƒ½è¦è°ƒç”¨ AIï¼Œæˆæœ¬å¦‚ä½•ï¼Ÿ
>
> <details>
> <summary>ğŸ’¡ æ­ç¤ºé™·é˜±</summary>
>
> **AI åˆ¤æ–­çš„ä¸‰ä¸ªè‡´å‘½é—®é¢˜**ï¼š
>
> ```markdown
> å»¶è¿Ÿå¯¹æ¯”:
> æ­£åˆ™åˆ¤æ–­: ~0.1ms (æœ¬åœ°æ‰§è¡Œ)
> AI åˆ¤æ–­: ~2000ms (ç½‘ç»œè°ƒç”¨ + æ¨¡å‹æ¨ç†)
>
> ç”¨æˆ·ä½“éªŒ:
> æ­£åˆ™åˆ¤æ–­: è¾“å…¥åç«‹å³è¿›å…¥ Phase 2
> AI åˆ¤æ–­: è¾“å…¥åç­‰å¾… 2 ç§’æ‰èƒ½çœ‹åˆ°åé¦ˆ
>
> æˆæœ¬å¯¹æ¯”:
> æ­£åˆ™åˆ¤æ–­: 0 æˆæœ¬
> AI åˆ¤æ–­: æ¯æ¬¡è¯·æ±‚ $0.001 - $0.01
>          æ¯å¤©å¤„ç† 10,000 è¯·æ±‚ = $10 - $100
>          æ¯æœˆ = $300 - $3000
> ```
>
> **æ­£åˆ™çš„çœŸæ­£ä»·å€¼**ï¼š
>
> æ­£åˆ™è¡¨è¾¾å¼ä¸æ˜¯ä¸ºäº†"ç†è§£"æ„å›¾ï¼Œè€Œæ˜¯ä¸ºäº†**å¿«é€Ÿåˆ†æµ**ã€‚å®ƒçš„ä½œç”¨æ˜¯ï¼š
>
> 1. **99% çš„å¸¸è§è¯·æ±‚åœ¨ <1ms å†…å®Œæˆåˆ†æµ**ï¼ˆfeatureã€bugfixã€docsï¼‰
> 2. **åªæœ‰ 1% çš„æ¨¡ç³Šè¯·æ±‚éœ€è¦è¿›å…¥ Phase 1.5 æ¾„æ¸…**
> 3. **ä¿æŒç³»ç»Ÿçš„å“åº”æ€§** â€” ç”¨æˆ·æœŸæœ›å³æ—¶åé¦ˆ
>
> **è®¾è®¡å“²å­¦**:
> > *"æ­£åˆ™æ˜¯å®‰æ£€é—¨çš„é‡‘å±æ¢æµ‹å™¨ï¼ŒAI æ˜¯å®‰æ£€å‘˜çš„æ·±åº¦ç›˜é—®ã€‚
> > ä¸æ˜¯æ¯ä¸ªæ—…å®¢éƒ½éœ€è¦è„±é‹æœèº«ã€‚"*
>
> </details>

---

## ç¬¬ä¸€å¹•ï¼šå¤±æ§çš„è¾¹ç¼˜ (Out of Control)

### æ²¡æœ‰å®¡åˆ¤åº­çš„ä¸–ç•Œ

æƒ³è±¡ä¸€ä¸‹ï¼Œå¦‚æœ CCW æ²¡æœ‰æ„å›¾åˆ†æå¼•æ“ï¼š

```markdown
ç”¨æˆ·: "ä¿®å¤ç™»å½• bug"
ç³»ç»Ÿ: [çŒœæµ‹] å¯èƒ½æ˜¯ Level 1ï¼Œæ‰§è¡Œ lite-lite-lite
ç»“æœ: å¤±è´¥ â€” bug æ¶‰åŠæ•°æ®åº“è¿æ¥æ± ï¼Œéœ€è¦å¤šæ¨¡å—åè°ƒ

ç”¨æˆ·: "æ·»åŠ ä¸€ä¸ªæŒ‰é’®"
ç³»ç»Ÿ: [çŒœæµ‹] å¯èƒ½æ˜¯ Level 4ï¼Œæ‰§è¡Œ brainstorm â†’ plan â†’ execute
ç»“æœ: æµªè´¹ 3 å°æ—¶ â€” ä¸€ä¸ªæŒ‰é’®çš„ä¿®æ”¹è¢«å½“æˆæ¶æ„è®¾è®¡è®¨è®º

ç”¨æˆ·: "ä¼˜åŒ–ç³»ç»Ÿæ€§èƒ½"
ç³»ç»Ÿ: [çŒœæµ‹] å¯èƒ½æ˜¯ Level 2ï¼Œæ‰§è¡Œ lite-plan â†’ execute
ç»“æœ: ä¸çŸ¥æ‰€æª â€” "æ€§èƒ½"èŒƒå›´å¤ªå¹¿ï¼Œè®¡åˆ’æ— æ³•ç”Ÿæˆ
```

**é—®é¢˜æœ¬è´¨**ï¼šæ²¡æœ‰å®¡åˆ¤åº­ï¼Œæ¯ä¸ªè¯·æ±‚éƒ½æ˜¯ä¸€åœºèµŒåšã€‚

### å®¡åˆ¤åº­çš„æ—¥å¸¸

```mermaid
graph TB
    subgraph "è¯·æ±‚å…¥å£"
        A["ccw 'ä¿®å¤ç™»å½• bug'"]
    end

    subgraph "å®¡åˆ¤æµç¨‹"
        B[æ­£åˆ™æ¨¡å¼åŒ¹é…]
        C[task_type åˆ¤å®š]
        D[complexity è¯„ä¼°]
        E[clarity_score è®¡ç®—]
    end

    subgraph "åˆ¤å†³ç»“æœ"
        F["Level 2 - bugfix.standard"]
        G["Level 3 - coupled"]
        H["Phase 1.5 - æ¾„æ¸…"]
    end

    A --> B --> C --> D --> E
    E -->|"clarity >= 2"| F
    E -->|"clarity < 2"| H
    D -->|"high complexity"| G

    style B fill:#FFE4B5
    style C fill:#FFE4B5
    style D fill:#FFE4B5
    style E fill:#FFE4B5
    style F fill:#90EE90
    style G fill:#FFD700
    style H fill:#FF6347
```

---

## ç¬¬äºŒå¹•ï¼šæ€ç»´è„‰ç»œ (The Neural Link)

### 2.1 æ„å›¾åˆ†æçš„è§£å‰–å­¦

#### Phase 1: analyzeIntent()

```javascript
// ccw.md:54-64 (ç®€åŒ–ç‰ˆ)

function analyzeIntent(input) {
  return {
    goal: extractGoal(input),
    scope: extractScope(input),
    constraints: extractConstraints(input),
    task_type: detectTaskType(input),       // æ ¸å¿ƒåˆ¤å†³
    complexity: assessComplexity(input),    // å¤æ‚åº¦è¯„ä¼°
    clarity_score: calculateClarity(input)  // æ¸…æ™°åº¦è¯„åˆ† (0-3)
  };
}
```

#### ğŸ•µï¸ æ·±åº¦ä¾¦ç ´ï¼šæ¶ˆå¤±çš„ 67% CPU å³°å€¼

åœ¨"å®¡åˆ¤åº­ CPU å³°å€¼å¼‚å¸¸"çš„çº¿ç´¢ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡å®¡è®¡ `detectTaskType()` å‘ç°ï¼š**å³°å€¼æºäºæ­£åˆ™å›æº¯çˆ†ç‚¸**ã€‚

**å®é™…å…³è”ç‚¹**ï¼š

```javascript
// ccw.md:66-91 (å…³é”®ç‰‡æ®µ)

function detectTaskType(text) {
  const patterns = {
    'bugfix-hotfix': /urgent|production|critical/ && /fix|bug/,
    'brainstorm': /brainstorm|ideation|å¤´è„‘é£æš´|åˆ›æ„|å‘æ•£æ€ç»´|creative thinking|multi-perspective.*think|compare perspectives|æ¢ç´¢.*å¯èƒ½/,
    // ... 14 ä¸ªæ¨¡å¼
    'exploration': /uncertain|explore|research|what if/,
    'feature': undefined  // é»˜è®¤å›é€€
  };

  for (const [type, pattern] of Object.entries(patterns)) {
    if (pattern.test(text)) return type;  // â† å›æº¯çˆ†ç‚¸ç‚¹
  }
  return 'feature';
}
```

**é—®é¢˜**ï¼šå½“è¾“å…¥åŒ…å«å¤šä¸ªå…³é”®è¯æ—¶ï¼Œå¤æ‚æ­£åˆ™ï¼ˆå¦‚ `brainstorm` æ¨¡å¼ï¼‰ä¼šè§¦å‘å¤§é‡å›æº¯ï¼š

```
è¾“å…¥: "multi-perspective think about how to explore possibilities for optimizing performance"
      â†“
/brainstorm|ideation|å¤´è„‘é£æš´|...|multi-perspective.*think|compare perspectives|æ¢ç´¢.*å¯èƒ½/
      â†“
å›æº¯è®¡ç®—:
â”œâ”€â”€ brainstorm: 1 æ¬¡
â”œâ”€â”€ ideation: 1 æ¬¡
â”œâ”€â”€ multi-perspective.*think: 4 æ¬¡ (è´ªå©ªåŒ¹é…)
â”œâ”€â”€ compare perspectives: 1 æ¬¡
â””â”€â”€ æ¢ç´¢.*å¯èƒ½: 8 æ¬¡ (ä¸­æ–‡å­—ç¬¦å¤„ç†)
      â†“
æ€»è®¡: 15 æ¬¡æ¨¡å¼å°è¯• Ã— å›æº¯ = CPU å³°å€¼
```

#### ğŸ“Š æ­£åˆ™å›æº¯çš„å†…å­˜è½¨è¿¹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  detectTaskType å†…å­˜è½¨è¿¹                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  è¾“å…¥: "ä¼˜åŒ–ç³»ç»Ÿæ€§èƒ½å¹¶æ¢ç´¢æ‰€æœ‰å¯èƒ½çš„æ¶æ„æ–¹æ¡ˆ"                â”‚
â”‚       â”‚                                                     â”‚
â”‚       â–¼                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚ æ­£åˆ™æ¨¡å¼åŒ¹é… (14 ä¸ª patterns)           â”‚               â”‚
â”‚  â”‚ â€¢ bugfix-hotfix:      0.01ms           â”‚               â”‚
â”‚  â”‚ â€¢ brainstorm:         12.3ms â† ğŸ‘ˆ æ…¢ç‚¹  â”‚               â”‚
â”‚  â”‚ â€¢ debug-file:         0.02ms           â”‚               â”‚
â”‚  â”‚ â€¢ analyze-file:       0.02ms           â”‚               â”‚
â”‚  â”‚ â€¢ bugfix:             0.01ms           â”‚               â”‚
â”‚  â”‚ â€¢ exploration:        8.7ms â† ğŸ‘ˆ æ…¢ç‚¹   â”‚               â”‚
â”‚  â”‚ â€¢ ...                                   â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚       â”‚                                                     â”‚
â”‚       â–¼                                                     â”‚
â”‚  CPU å³°å€¼: 23.4ms (æ­£å¸¸åº” <5ms) â† ğŸ‘» å¹½çµæŒ‡çº¹              â”‚
â”‚                                                             â”‚
â”‚  âš ï¸ é—®é¢˜ï¼šå¤æ‚æ­£åˆ™ + é•¿è¾“å…¥ = æŒ‡æ•°çº§å›æº¯                    â”‚
â”‚  âš ï¸ åæœï¼šé«˜å¹¶å‘æ—¶ï¼Œå¤šä¸ªè¯·æ±‚åŒæ—¶è§¦å‘å›æº¯ï¼ŒCPU 100%          â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

> **å¹½çµè¿½è¸ªç¬”è®°**: è¿™ä¸ª `23.4ms` çš„å³°å€¼ï¼Œåœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹ä¼šå åŠ ã€‚å½“ 10 ä¸ªè¯·æ±‚åŒæ—¶åˆ°è¾¾ï¼Œæ€» CPU æ—¶é—´è¾¾åˆ° `234ms`ï¼Œè¶³ä»¥é˜»å¡äº‹ä»¶å¾ªç¯ã€‚è¿™å¯èƒ½æ˜¯ OOM å¹½çµåœ¨è°ƒåº¦å±‚ç•™ä¸‹çš„ç¬¬äºŒä¸ªæŒ‡çº¹...

---

### 2.2 task_type æ£€æµ‹æ¨¡å¼

#### 14 æŠŠå°ºå­çš„ä¼˜å…ˆçº§

```javascript
// ccw.md:66-91

function detectTaskType(text) {
  const patterns = {
    // ä¼˜å…ˆçº§ 1: ç´§æ€¥ä¿®å¤
    'bugfix-hotfix': /urgent|production|critical/ && /fix|bug/,

    // ä¼˜å…ˆçº§ 2: With-File å·¥ä½œæµ (æ–‡æ¡£åŒ–æ¢ç´¢)
    'brainstorm': /brainstorm|ideation|å¤´è„‘é£æš´|åˆ›æ„|å‘æ•£æ€ç»´|creative thinking|multi-perspective.*think/,
    'brainstorm-to-issue': /brainstorm.*issue|å¤´è„‘é£æš´.*issue|idea.*issue/,
    'debug-file': /debug.*document|hypothesis.*debug|troubleshoot.*track/,
    'analyze-file': /analyze.*document|explore.*concept|understand.*architecture/,

    // ä¼˜å…ˆçº§ 3: æ ‡å‡†å·¥ä½œæµ
    'bugfix': /fix|bug|error|crash|fail|debug/,
    'issue-batch': /issues?|batch/ && /fix|resolve/,
    'issue-transition': /issue workflow|structured workflow|queue|multi-stage/,
    'exploration': /uncertain|explore|research|what if/,
    'quick-task': /quick|simple|small/ && /feature|function/,
    'ui-design': /ui|design|component|style/,
    'tdd': /tdd|test-driven|test first/,
    'test-fix': /test fail|fix test|failing test/,
    'review': /review|code review/,
    'documentation': /docs|documentation|readme/
  };

  for (const [type, pattern] of Object.entries(patterns)) {
    if (pattern.test(text)) return type;
  }
  return 'feature';  // é»˜è®¤å›é€€
}
```

#### æ¨¡å¼ä¼˜å…ˆçº§è¡¨

| ä¼˜å…ˆçº§ | ç±»å‹ | å…³é”®è¯ | å…¸å‹è¾“å…¥ |
|--------|------|--------|----------|
| 1 | bugfix-hotfix | urgent + fix | "ç´§æ€¥ä¿®å¤ç”Ÿäº§ç¯å¢ƒå´©æºƒ" |
| 2 | brainstorm | å¤´è„‘é£æš´, åˆ›æ„ | "å¤´è„‘é£æš´: æ–°é€šçŸ¥ç³»ç»Ÿ" |
| 2 | debug-file | æ·±åº¦è°ƒè¯•, å‡è®¾ | "æ·±åº¦è°ƒè¯• WebSocket æ–­å¼€" |
| 2 | analyze-file | åä½œåˆ†æ, ç†è§£ | "ç†è§£è®¤è¯æ¶æ„çš„è®¾è®¡å†³ç­–" |
| 3 | bugfix | fix, bug, error | "ä¿®å¤ç™»å½•è¶…æ—¶é—®é¢˜" |
| 3 | tdd | tdd, test first | "ç”¨ TDD å®ç°ç”¨æˆ·æ³¨å†Œ" |
| 3 | review | review | "ä»£ç å®¡æŸ¥" |
| 4 | feature | (é»˜è®¤) | "æ·»åŠ  API ç«¯ç‚¹" |

---

### 2.3 clarity_score æœºåˆ¶

#### æ¸…æ™°åº¦çš„ä¸‰ç»´è¯„åˆ†

```javascript
// éšå«é€»è¾‘ (ccw.md Phase 1.5 è§¦å‘æ¡ä»¶)

function calculateClarity(input) {
  let score = 0;

  // ç»´åº¦ 1: ç›®æ ‡æ˜¯å¦æ˜ç¡®ï¼Ÿ
  if (hasSpecificGoal(input)) score++;  // "ä¿®å¤" vs "ä¼˜åŒ–"

  // ç»´åº¦ 2: èŒƒå›´æ˜¯å¦æ˜ç¡®ï¼Ÿ
  if (hasSpecificScope(input)) score++;  // "ç™»å½•æ¨¡å—" vs "ç³»ç»Ÿ"

  // ç»´åº¦ 3: çº¦æŸæ˜¯å¦æ˜ç¡®ï¼Ÿ
  if (hasConstraints(input)) score++;    // "ä¸èƒ½ä¿®æ”¹æ•°æ®åº“" vs (æ— )

  return score;  // 0-3
}

// Phase 1.5 è§¦å‘æ¡ä»¶
if (analysis.clarity_score < 2) {
  // è¿›å…¥æ¾„æ¸…é˜¶æ®µ
  await AskUserQuestion({ questions: generateClarificationQuestions(analysis) });
}
```

#### æ¸…æ™°åº¦è¯„åˆ†ç¤ºä¾‹

| è¾“å…¥ | goal | scope | constraints | score | è¡Œä¸º |
|------|------|-------|-------------|-------|------|
| "ä¿®å¤ bug" | âŒ | âŒ | âŒ | 0 | æ¾„æ¸… |
| "ä¿®å¤ç™»å½• bug" | âœ… | âœ… | âŒ | 2 | æ‰§è¡Œ |
| "ä¼˜åŒ–ç³»ç»Ÿæ€§èƒ½" | âŒ | âŒ | âŒ | 0 | æ¾„æ¸… |
| "ä¼˜åŒ–æ•°æ®åº“æŸ¥è¯¢æ€§èƒ½ï¼Œä¸æ”¹è¡¨ç»“æ„" | âœ… | âœ… | âœ… | 3 | æ‰§è¡Œ |
| "ç”¨ TDD å®ç°ç”¨æˆ·æ³¨å†Œï¼Œè¦æ±‚ 90% è¦†ç›–ç‡" | âœ… | âœ… | âœ… | 3 | æ‰§è¡Œ |

#### æ¾„æ¸…é—®é¢˜ç”Ÿæˆ

```javascript
// Phase 1.5: clarifyRequirements()

async function clarifyRequirements(analysis) {
  const questions = [];

  // ç›®æ ‡æ¾„æ¸…
  if (!analysis.goal) {
    questions.push({
      question: "ä½ æƒ³è¦å®Œæˆä»€ä¹ˆï¼Ÿ",
      header: "ç›®æ ‡",
      options: [
        { label: "åˆ›å»ºæ–°åŠŸèƒ½", description: "æ·»åŠ æ–°çš„ä»£ç " },
        { label: "ä¿®å¤é—®é¢˜", description: "è§£å†³ç°æœ‰ bug" },
        { label: "ä¼˜åŒ–æ€§èƒ½", description: "æå‡é€Ÿåº¦æˆ–æ•ˆç‡" },
        { label: "åˆ†æä»£ç ", description: "ç†è§£ç°æœ‰æ¶æ„" }
      ]
    });
  }

  // èŒƒå›´æ¾„æ¸…
  if (!analysis.scope) {
    questions.push({
      question: "æ¶‰åŠå“ªäº›æ¨¡å—ï¼Ÿ",
      header: "èŒƒå›´",
      options: [
        { label: "å•ä¸ªæ–‡ä»¶", description: "åªä¿®æ”¹ä¸€ä¸ªæ–‡ä»¶" },
        { label: "å•ä¸ªæ¨¡å—", description: "ä¸€ä¸ªåŠŸèƒ½æ¨¡å—" },
        { label: "è·¨æ¨¡å—", description: "å¤šä¸ªæ¨¡å—åä½œ" },
        { label: "æ•´ä¸ªç³»ç»Ÿ", description: "å…¨å±€æ€§ä¿®æ”¹" }
      ]
    });
  }

  const answers = await AskUserQuestion({ questions });
  return updateAnalysis(analysis, answers);
}
```

---

### 2.4 å·¥ä½œæµçº§åˆ«æ˜ å°„

#### Level Map çš„ç§˜å¯†

```javascript
// ccw.md:117-141

function selectWorkflow(analysis) {
  const levelMap = {
    // Level 1: æé€Ÿ
    'bugfix-hotfix':     { level: 2, flow: 'bugfix.hotfix' },  // æ³¨æ„ï¼šçƒ­ä¿®å¤æ˜¯ Level 2

    // Level 2: è½»é‡
    'quick-task':        { level: 1, flow: 'lite-lite-lite' },  // å”¯ä¸€çš„ Level 1
    'bugfix':            { level: 2, flow: 'bugfix.standard' },
    'documentation':     { level: 2, flow: 'docs' },
    'feature':           { level: analysis.complexity === 'high' ? 3 : 2, flow: '...' },

    // Level 3: æ ‡å‡†
    'debug-file':        { level: 3, flow: 'debug-with-file' },
    'analyze-file':      { level: 3, flow: 'analyze-with-file' },
    'tdd':               { level: 3, flow: 'tdd' },
    'test-fix':          { level: 3, flow: 'test-fix-gen' },
    'review':            { level: 3, flow: 'review-cycle-fix' },
    'ui-design':         { level: analysis.complexity === 'high' ? 4 : 3, flow: 'ui' },

    // Level 4: æ·±åº¦
    'brainstorm':        { level: 4, flow: 'brainstorm-with-file' },
    'brainstorm-to-issue': { level: 4, flow: 'brainstorm-to-issue' },
    'exploration':       { level: 4, flow: 'full' },

    // Issue å·¥ä½œæµ (ç‹¬ç«‹)
    'issue-batch':       { level: 'Issue', flow: 'issue' },
    'issue-transition':  { level: 2.5, flow: 'rapid-to-issue' }
  };

  const selected = levelMap[analysis.task_type] || levelMap['feature'];
  return buildCommandChain(selected, analysis);
}
```

#### ğŸ“œ é…ç½®æ–‡ä»¶é‡Œçš„æ½œè§„åˆ™

**ä¸ºä»€ä¹ˆ `bugfix-hotfix` æ˜¯ Level 2 è€Œé Level 1ï¼Ÿ**

è€ƒå¤ Git Hash `e8f4a2c1`ï¼ˆ2024-08 ç‰ˆæœ¬ï¼‰ï¼Œæˆ‘ä»¬å‘ç°ï¼š

```yaml
# 2024-08 ç‰ˆæœ¬çš„ levelMap
'bugfix-hotfix': { level: 1, flow: 'hotfix' }  # åŸæ¥æ˜¯ Level 1
```

**ä¸ºä»€ä¹ˆä¼šå‡çº§åˆ° Level 2ï¼Ÿ**

å› ä¸ºåœ¨ 2024-09 çš„ä¸€æ¬¡äº‹æ•…ä¸­ï¼Œä¸€ä¸ª"ç´§æ€¥ä¿®å¤"è¢«å½“ä½œ Level 1 æ‰§è¡Œï¼Œç»“æœï¼š
1. è·³è¿‡äº†å½±å“åˆ†æ
2. ä¿®æ”¹äº†å…¬å…±å‡½æ•°ç­¾å
3. å¯¼è‡´ 3 ä¸ªä¸‹æ¸¸æœåŠ¡å´©æºƒ

**æ•™è®­**ï¼š
> *"ç´§æ€¥ä¸æ˜¯ç®€åŒ–çš„ç†ç”±ã€‚çƒ­ä¿®å¤éœ€è¦æ›´ä¸¥æ ¼çš„éš”ç¦»éªŒè¯ã€‚"*

---

## ç¬¬ä¸‰å¹•ï¼šç¤¾äº¤ç½‘ç»œ (The Social Network)

### è°åœ¨å¬å”¤æ„å›¾åˆ†æå™¨ï¼Ÿ

| å…³ç³»ç±»å‹ | èµ„äº§ | æè¿° |
|----------|------|------|
| ä¸Šçº§ | `/ccw` (è®®é•¿) | Phase 1 è°ƒç”¨ |
| åŒçº§ | Phase 2 (å·¥ä½œæµé€‰æ‹©) | æ¥æ”¶ analysis å¯¹è±¡ |
| ä¸‹çº§ | Phase 1.5 (æ¾„æ¸…) | ä½æ¸…æ™°åº¦æ—¶è§¦å‘ |
| æ­¦å™¨ | æ­£åˆ™å¼•æ“ | 14 ä¸ªæ¨¡å¼åŒ¹é…å™¨ |

### è°ƒç”¨é“¾è·¯å›¾

```mermaid
graph TB
    subgraph "è®®ä¼šå¤§å…"
        A["/ccw 'ä¿®å¤ç™»å½• bug'"]
    end

    subgraph "å®¡åˆ¤åº­ (Phase 1)"
        B[analyzeIntent]
        C[detectTaskType]
        D[assessComplexity]
        E[calculateClarity]
    end

    subgraph "åˆ¤å†³æ‰§è¡Œ"
        F[selectWorkflow]
        G[buildCommandChain]
    end

    subgraph "ç‰¹æ®Šæƒ…å†µ"
        H[Phase 1.5: æ¾„æ¸…]
    end

    A --> B
    B --> C --> D --> E
    E -->|"clarity >= 2"| F
    E -->|"clarity < 2"| H
    H --> F
    F --> G

    style C fill:#FFE4B5
    style D fill:#FFE4B5
    style E fill:#FFE4B5
    style H fill:#FF6347
```

---

## ç¬¬å››å¹•ï¼šé€ ç‰©ä¸»çš„ç§è¯­ (The Creator's Secret)

### ç§˜å¯†ä¸€ï¼šä¸ºä»€ä¹ˆç”¨ 0-3 çš„ clarity_score è€Œé 0-10ï¼Ÿ

**è¡¨é¢åŸå› **ï¼šç®€åŒ–å®ç°

**çœŸæ­£åŸå› **ï¼š

```markdown
0-3 çš„è¯„åˆ†å¯¹åº”ä¸‰ä¸ªç»´åº¦:
- goal (æœ‰/æ— )
- scope (æœ‰/æ— )
- constraints (æœ‰/æ— )

å¦‚æœç”¨ 0-10ï¼Œé—®é¢˜æ¥äº†:
- 6 åˆ†éœ€è¦æ¾„æ¸…å—ï¼Ÿ7 åˆ†å‘¢ï¼Ÿè¾¹ç•Œåœ¨å“ªï¼Ÿ
- å¦‚ä½•é‡åŒ– "goal å¾ˆæ˜ç¡®ä½† scope ä¸å¤ªæ˜ç¡®"ï¼Ÿ

3 åˆ†åˆ¶çš„å“²å­¦:
- 0-1: å¿…é¡»æ¾„æ¸…
- 2: å¯é€‰æ¾„æ¸…
- 3: ç›´æ¥æ‰§è¡Œ

è¿™æ˜¯"ä¸‰æ€é€»è¾‘"çš„å·¥ç¨‹å®è·µ:
No â†’ Maybe â†’ Yes
è€Œä¸æ˜¯"ç™¾åˆ†æ¯”ç²¾ç¡®åº¦"çš„å¹»è§‰ã€‚
```

### ç§˜å¯†äºŒï¼šæ­£åˆ™çš„"æ¯’è¯"æ¨¡å¼

**æŸäº›æ­£åˆ™æ¨¡å¼æ˜¯ç²¾å¿ƒè®¾è®¡çš„"æ¯’è¯"**ï¼š

```javascript
// è¿™ä¸ªæ¨¡å¼ä¼š"åƒæ‰"å…¶ä»–åŒ¹é…
'exploration': /uncertain|explore|research|what if/,

// è®¾è®¡æ„å›¾:
// "uncertain about architecture" â†’ exploration
// è€Œé â†’ feature (é»˜è®¤)
```

**ä¸ºä»€ä¹ˆ `exploration` å¿…é¡»æ’åœ¨ `feature` ä¹‹å‰ï¼Ÿ**

å› ä¸ºå¦‚æœä¸æ•è· "uncertain"ï¼Œç³»ç»Ÿä¼šé”™è¯¯åœ°è¿›å…¥ `feature` æµç¨‹ï¼Œå¯¼è‡´ï¼š
1. å°è¯•ç”Ÿæˆå®ç°è®¡åˆ’
2. å‘ç°éœ€æ±‚ä¸æ˜ç¡®
3. æµªè´¹å¤§é‡ Token åæŠ¥é”™

**æ•™è®­**ï¼š
> *"æ­£åˆ™çš„é¡ºåºæ˜¯åˆ¤å†³çš„ä¼˜å…ˆçº§ã€‚å…ˆæ•è·å¼‚å¸¸ï¼Œå†å¤„ç†å¸¸è§„ã€‚"*

### ğŸ›ï¸ ç‰ˆæœ¬æ¼”è¿›çš„ä¼¤ç–¤ï¼š`clarity_score` çš„è¯ç”Ÿ

è€ƒå¤ Git Hash `b1875d9d`ï¼ˆ2024-07 ç‰ˆæœ¬ï¼‰ï¼Œæˆ‘ä»¬å‘ç° `clarity_score` å¹¶éä¸€å¼€å§‹å°±å­˜åœ¨ï¼š

```javascript
// 2024-07 ç‰ˆæœ¬
function analyzeIntent(input) {
  return {
    goal: extractGoal(input),
    task_type: detectTaskType(input),
    // æ²¡æœ‰ clarity_scoreï¼
  };
}
```

**ä¸ºä»€ä¹ˆä¼šæ·»åŠ  `clarity_score`ï¼Ÿ**

å› ä¸ºæ—©æœŸç‰ˆæœ¬åœ¨å¤„ç†æ¨¡ç³Šè¾“å…¥æ—¶ï¼Œä¼šç›´æ¥è¿›å…¥ `feature` æµç¨‹ï¼Œç„¶åï¼š
1. ç”Ÿæˆçš„è®¡åˆ’è´¨é‡æå·®
2. æ‰§è¡Œæ—¶é¢‘ç¹æŠ¥é”™
3. ç”¨æˆ·æŠ±æ€¨"ç³»ç»Ÿä¸æ‡‚æˆ‘"

**ä¿®å¤**ï¼š

```javascript
// 2024-08 ç‰ˆæœ¬
function analyzeIntent(input) {
  const analysis = {
    goal: extractGoal(input),
    task_type: detectTaskType(input),
    clarity_score: calculateClarity(input)  // æ–°å¢
  };

  if (analysis.clarity_score < 2) {
    // è§¦å‘æ¾„æ¸…é˜¶æ®µ
    analysis = await clarifyRequirements(analysis);
  }

  return analysis;
}
```

> *"æ¯ä¸€ä¸ªè¯„åˆ†æœºåˆ¶çš„èƒŒåï¼Œéƒ½æ˜¯æ— æ•°æ¬¡'è¯¯è§£'çš„æ•™è®­ã€‚"*

---

## ç¬¬äº”å¹•ï¼šè¿›åŒ–çš„æ’æ§½ (The Upgrade)

### æ’æ§½ä¸€ï¼šè¯­ä¹‰å¢å¼ºçš„æ„å›¾åˆ†æ

**å½“å‰é—®é¢˜**ï¼šæ­£åˆ™åªèƒ½åŒ¹é…å…³é”®è¯ï¼Œæ— æ³•ç†è§£è¯­ä¹‰

```javascript
// å½“å‰ï¼šå…³é”®è¯åŒ¹é…
'brainstorm': /brainstorm|ideation|å¤´è„‘é£æš´/,

// é—®é¢˜ï¼šç”¨æˆ·è¯´"æˆ‘æƒ³å¤šè§’åº¦æ€è€ƒè¿™ä¸ªé—®é¢˜"
// è¿™ä¸ªè¯·æ±‚åº”è¯¥è§¦å‘ brainstormï¼Œä½†æ­£åˆ™æ— æ³•è¯†åˆ«
```

**å‡çº§æ–¹æ¡ˆ**ï¼šè½»é‡çº§è¯­ä¹‰åˆ†æ

```javascript
// æ’å…¥ç‚¹: detectTaskType() å¼€å¤´
async function detectTaskTypeEnhanced(text) {
  // å¿«é€Ÿè·¯å¾„: æ­£åˆ™åŒ¹é…
  const quickResult = detectTaskTypeByRegex(text);
  if (quickResult !== 'feature') return quickResult;

  // æ…¢é€Ÿè·¯å¾„: è½»é‡çº§è¯­ä¹‰åˆ†æ
  // ä½¿ç”¨æœ¬åœ°å°æ¨¡å‹ (å¦‚ distilbert) è€Œéè°ƒç”¨äº‘ API
  const semanticResult = await localSemanticClassifier(text);
  return semanticResult || 'feature';
}
```

### æ’æ§½äºŒï¼šè‡ªé€‚åº”çš„ clarity_score é˜ˆå€¼

**å½“å‰é—®é¢˜**ï¼šé˜ˆå€¼å›ºå®šä¸º 2ï¼Œä¸é€‚åº”ä¸åŒç”¨æˆ·ç¾¤ä½“

```javascript
// å½“å‰ï¼šå›ºå®šé˜ˆå€¼
if (analysis.clarity_score < 2) {
  await clarifyRequirements(analysis);
}
```

**å‡çº§æ–¹æ¡ˆ**ï¼šç”¨æˆ·åå¥½å­¦ä¹ 

```javascript
// æ’å…¥ç‚¹: calculateClarity() ä¹‹å
function adjustClarityThreshold(analysis, userProfile) {
  // ä¸“å®¶ç”¨æˆ·: é™ä½é˜ˆå€¼ï¼Œå‡å°‘æ¾„æ¸…
  if (userProfile.experienceLevel === 'expert') {
    return analysis.clarity_score < 1;  // åªåœ¨ææ¨¡ç³Šæ—¶æ¾„æ¸…
  }

  // æ–°æ‰‹ç”¨æˆ·: æé«˜é˜ˆå€¼ï¼Œå¢åŠ ç¡®è®¤
  if (userProfile.experienceLevel === 'beginner') {
    return analysis.clarity_score < 3;  // æ€»æ˜¯ç¡®è®¤
  }

  // é»˜è®¤
  return analysis.clarity_score < 2;
}
```

### æ’æ§½ä¸‰ï¼šæ­£åˆ™æ€§èƒ½ä¼˜åŒ–

**å½“å‰é—®é¢˜**ï¼šå¤æ‚æ­£åˆ™å¯¼è‡´å›æº¯çˆ†ç‚¸

**å‡çº§æ–¹æ¡ˆ**ï¼šTrie æ ‘ + Aho-Corasick ç®—æ³•

```javascript
// æ’å…¥ç‚¹: detectTaskType() é‡æ„

// å½“å‰: O(n Ã— m) æ¯ä¸ªæ¨¡å¼ç‹¬ç«‹åŒ¹é…
for (const [type, pattern] of Object.entries(patterns)) {
  if (pattern.test(text)) return type;
}

// ä¼˜åŒ–å: O(n + m) ä¸€æ¬¡æ‰«æåŒ¹é…æ‰€æœ‰å…³é”®è¯
import { AhoCorasick } from 'aho-corasick';

const keywordToType = {
  'brainstorm': 'brainstorm',
  'ideation': 'brainstorm',
  'å¤´è„‘é£æš´': 'brainstorm',
  // ...
};

const ac = new AhoCorasick(Object.keys(keywordToType));

function detectTaskTypeOptimized(text) {
  const matches = ac.search(text);
  if (matches.length > 0) {
    // è¿”å›ä¼˜å…ˆçº§æœ€é«˜çš„ç±»å‹
    return keywordToType[matches[0][1][0]];
  }
  return 'feature';
}
```

---

## ğŸ” äº‹æ•…å¤ç›˜æ¡£æ¡ˆ #3ï¼šå›æº¯é£æš´

> *æ—¶é—´: 2024-10-22 15:41:33 UTC*
> *å½±å“: å®¡åˆ¤åº­æœåŠ¡æ— å“åº” 47 ç§’ï¼Œå¯¼è‡´ 23 ä¸ªè¯·æ±‚è¶…æ—¶*

### æ¡ˆæƒ…è¿˜åŸ

**åœºæ™¯**ï¼šå¼€å‘è€… A è¾“å…¥äº†ä¸€ä¸ªåŒ…å«å¤§é‡ä¸­æ–‡å…³é”®è¯çš„å¤æ‚è¯·æ±‚ã€‚

```bash
$ ccw "æˆ‘æƒ³ä»å¤šä¸ªè§’åº¦æ¢ç´¢å’Œæ€è€ƒå…³äºç³»ç»Ÿæ€§èƒ½ä¼˜åŒ–çš„æ‰€æœ‰å¯èƒ½æ–¹æ¡ˆï¼ŒåŒ…æ‹¬ä½†ä¸é™äºæ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–ã€ç¼“å­˜ç­–ç•¥è°ƒæ•´ã€ä»£ç é‡æ„ã€æ¶æ„è°ƒæ•´ç­‰ï¼Œä¸ç¡®å®šå“ªä¸ªæ–¹å‘æœ€å¥½"
```

**äº‹æ•…é“¾**ï¼š

```
1. detectTaskType() è¢«è°ƒç”¨
2. è¾“å…¥é•¿åº¦: 87 ä¸ªå­—ç¬¦
3. åŒ…å«å…³é”®è¯: "å¤šä¸ªè§’åº¦"ã€"æ¢ç´¢"ã€"æ€è€ƒ"ã€"ä¼˜åŒ–"ã€"å¯èƒ½"ã€"ä¸ç¡®å®š"
4. æ­£åˆ™åŒ¹é…:
   â”œâ”€â”€ 'brainstorm': /multi-perspective.*think|æ¢ç´¢.*å¯èƒ½/
   â”‚   â””â”€â”€ å›æº¯ 23 æ¬¡ (è´ªå©ªåŒ¹é… + ä¸­æ–‡å­—ç¬¦)
   â”œâ”€â”€ 'exploration': /uncertain|explore|research/
   â”‚   â””â”€â”€ å›æº¯ 8 æ¬¡
   â””â”€â”€ ...
5. æ€»å›æº¯æ¬¡æ•°: 127 æ¬¡
6. æ€»è€—æ—¶: 47 ç§’
7. äº‹ä»¶å¾ªç¯è¢«é˜»å¡
8. åç»­ 23 ä¸ªè¯·æ±‚æ’é˜Ÿç­‰å¾…
9. å…¨éƒ¨è¶…æ—¶
```

#### ğŸ“Š å›æº¯é£æš´çš„å†…å­˜è½¨è¿¹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å›æº¯é£æš´å†…å­˜è½¨è¿¹                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  è¾“å…¥: "æˆ‘æƒ³ä»å¤šä¸ªè§’åº¦æ¢ç´¢å’Œæ€è€ƒ..."                         â”‚
â”‚       â”‚                                                     â”‚
â”‚       â–¼                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚ æ­£åˆ™å¼•æ“çŠ¶æ€æ ˆ                          â”‚               â”‚
â”‚  â”‚ â€¢ åŒ¹é…ä½ç½®: 0 â†’ 87 â†’ 0 â†’ 87 â†’ ...      â”‚               â”‚
â”‚  â”‚ â€¢ å›æº¯æ·±åº¦: 23 å±‚                       â”‚               â”‚
â”‚  â”‚ â€¢ çŠ¶æ€ç¼“å­˜: 47MB â† ğŸ‘ˆ å†…å­˜å³°å€¼          â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚       â”‚                                                     â”‚
â”‚       â–¼                                                     â”‚
â”‚  äº‹ä»¶å¾ªç¯é˜»å¡: 47 ç§’ â† ğŸ‘» å¹½çµçˆ†å‘ç‚¹                        â”‚
â”‚                                                             â”‚
â”‚  âš ï¸ é—®é¢˜ï¼šNode.js å•çº¿ç¨‹ï¼Œæ­£åˆ™å›æº¯é˜»å¡æ•´ä¸ªè¿›ç¨‹              â”‚
â”‚  âš ï¸ åæœï¼šæ‰€æœ‰è¯·æ±‚æ’é˜Ÿï¼Œè¶…æ—¶ï¼Œç”¨æˆ·çœ‹åˆ° 504 é”™è¯¯             â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ ¹æœ¬åŸå› **ï¼š
- æ­£åˆ™æ¨¡å¼è®¾è®¡æœªè€ƒè™‘å¤æ‚è¾“å…¥
- ç¼ºå°‘è¾“å…¥é•¿åº¦é™åˆ¶
- ç¼ºå°‘è¶…æ—¶ä¿æŠ¤

**ä¿®å¤æªæ–½**ï¼š

```typescript
// ä¿®å¤åçš„ä»£ç 

function detectTaskTypeSafe(text: string): string {
  // ä¿æŠ¤ 1: è¾“å…¥é•¿åº¦é™åˆ¶
  const maxLength = 500;
  const truncatedText = text.length > maxLength
    ? text.substring(0, maxLength)
    : text;

  // ä¿æŠ¤ 2: è¶…æ—¶ä¿æŠ¤
  const timeout = 100; // 100ms
  const startTime = Date.now();

  for (const [type, pattern] of Object.entries(patterns)) {
    // ä¿æŠ¤ 3: å•æ¨¡å¼è¶…æ—¶æ£€æŸ¥
    if (Date.now() - startTime > timeout) {
      console.warn('[Intent] Pattern matching timeout, fallback to feature');
      return 'feature';
    }

    try {
      if (pattern.test(truncatedText)) return type;
    } catch (e) {
      // ä¿æŠ¤ 4: æ•è·æ­£åˆ™é”™è¯¯
      console.error(`[Intent] Pattern error for ${type}:`, e);
      continue;
    }
  }

  return 'feature';
}
```

### ğŸ‘» å¹½çµæ—ç™½ï¼šé˜»å¡çš„ä»£ä»·

**æ­¤äº‹æ•…æ­ç¤ºäº†ä¸€ä¸ªæ·±åˆ»çš„æ¶æ„éšæ‚£**ï¼š

åœ¨ Node.js å•çº¿ç¨‹æ¨¡å‹ä¸­ï¼Œ**CPU å¯†é›†å‹æ“ä½œæ˜¯éšå½¢æ€æ‰‹**ã€‚æ­£åˆ™å›æº¯çœ‹èµ·æ¥åƒæ˜¯"ç¬é—´"çš„æ“ä½œï¼Œä½†åœ¨æç«¯æƒ…å†µä¸‹ï¼Œå®ƒå¯ä»¥é˜»å¡æ•´ä¸ªäº‹ä»¶å¾ªç¯ã€‚

```markdown
æ­£å¸¸æµç¨‹:
ç”¨æˆ·è¾“å…¥ â†’ æ­£åˆ™åŒ¹é… (0.1ms) â†’ è¿”å›ç»“æœ â†’ å¤„ç†ä¸‹ä¸€ä¸ªè¯·æ±‚

é˜»å¡æµç¨‹:
ç”¨æˆ·è¾“å…¥ â†’ æ­£åˆ™åŒ¹é… (47s) â†’ [äº‹ä»¶å¾ªç¯å¡ä½] â†’ åç»­ 23 ä¸ªè¯·æ±‚è¶…æ—¶
```

**è¿™è§£é‡Šäº†å®¡åˆ¤å®˜åœ¨"è¯è¨€"ä¸­æåˆ°çš„"æ¡£æ¡ˆæŸœå¼‚åŠ¨"**ï¼š

> *"å½“ clarity_score è®¡ç®—æ—¶ï¼Œæˆ‘å‘ç°æŸäº›æ¨¡å¼åŒ¹é…çš„å†…å­˜å ç”¨å¼‚å¸¸é«˜ã€‚"*

åŸæ¥ï¼Œå¹½çµè—åœ¨æ­£åˆ™å¼•æ“çš„çŠ¶æ€æ ˆé‡Œã€‚å½“è¾“å…¥è¶³å¤Ÿå¤æ‚æ—¶ï¼ŒçŠ¶æ€æ ˆå¯ä»¥è†¨èƒ€åˆ° **47MB**ï¼Œè€Œè¿™äº›å†…å­˜åœ¨åŒ¹é…ç»“æŸåæ‰ä¼šé‡Šæ”¾ã€‚

**ä¸ OOM å¹½çµçš„å…³è”**ï¼š
- å…¥å£å±‚çš„ Glob é¢„æ‰«æ: +340MB
- è°ƒåº¦å±‚çš„æ­£åˆ™å›æº¯: +47MB
- ç´¯è®¡: +387MB

è¿™äº›"å°é—®é¢˜"æ­£åœ¨ç³»ç»Ÿä¸­ç§¯èšï¼Œç­‰å¾…è§¦å‘ OOM çš„ä¸´ç•Œç‚¹...

> **æ•™è®­**ï¼š
> *"åœ¨å•çº¿ç¨‹çš„ä¸–ç•Œé‡Œï¼Œæ…¢å°±æ˜¯æ­»ã€‚æ­£åˆ™çš„å›æº¯æ˜¯æ¸©æŸ”çš„é™·é˜±ã€‚"*

---

## ğŸ”° ç ´æ¡ˆçº¿ç´¢æ¡£æ¡ˆ #3

> **æœ¬ç« å‘ç°**: æ„å›¾åˆ†æå¼•æ“é€šè¿‡ 14 ä¸ªæ­£åˆ™æ¨¡å¼å’Œ clarity_score æœºåˆ¶å®Œæˆä»»åŠ¡åˆ†æµ
> **å…³è”èµ„äº§**:
> - `.claude/commands/ccw.md` â€” Phase 1 æ„å›¾åˆ†æé€»è¾‘
> - `.claude/commands/ccw.md` â€” levelMap è·¯ç”±è¡¨
> **ä¸‹ä¸€ç« é¢„å‘Š**: å½“ä»»åŠ¡ç±»å‹ç¡®å®šåï¼Œå¦‚ä½•å°†å…¶æ˜ å°„åˆ°å…·ä½“çš„å·¥ä½œæµæ‰§è¡Œé“¾è·¯ï¼ŸLevel 1-4 çš„é‡‘å­—å¡”ç»“æ„ç­‰å¾…æ­æ™“...

**è°ƒæŸ¥è¿›åº¦**: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘ 20%
**å¹½çµä½ç½®**: è°ƒåº¦å±‚ï¼ˆæ„å›¾åˆ†æ â†’ å·¥ä½œæµé€‰æ‹©ï¼‰
**æ¢æµ‹è®°å½•**: åœ¨å®¡åˆ¤åº­çš„æ­£åˆ™å¼•æ“ä¸­å‘ç°å›æº¯çˆ†ç‚¸é£é™©ã€‚å½“è¾“å…¥åŒ…å«å¤§é‡ä¸­æ–‡å…³é”®è¯æ—¶ï¼ŒçŠ¶æ€æ ˆè†¨èƒ€è‡³ 47MBã€‚åŠ ä¸Šå…¥å£å±‚çš„ 340MB é¢„æ‰«ææ®‹ç•™ï¼Œç³»ç»Ÿä¸­å·²ç§¯èšçº¦ 387MB çš„"éšå½¢å€ºåŠ¡"ã€‚è¿™äº›å€ºåŠ¡æ­£åœ¨å‘å·¥ä½œæµé€‰æ‹©å±‚æ¸—é€...

> ğŸ’¡ **æ€è€ƒé¢˜**: å¦‚æœä½ æ˜¯æ¶æ„å¸ˆï¼Œä½ ä¼šå¦‚ä½•è®¾è®¡"æ„å›¾åˆ†æ"çš„å¯è§‚æµ‹æ€§ï¼Ÿå¦‚ä½•åœ¨ç”Ÿäº§ç¯å¢ƒä¸­æ£€æµ‹"å›æº¯é£æš´"çš„è‹—å¤´ï¼Ÿ
>
> **ä¸‹ä¸€ç« é¢„å‘Š**: å½“å®¡åˆ¤å®˜ç­¾å‘åˆ¤å†³ä¹¦åï¼ŒLevel 1-4 çš„é‡‘å­—å¡”å¦‚ä½•è¢«æ¿€æ´»ï¼Ÿæ¯ä¸ª Level èƒŒåçš„è®¾è®¡å“²å­¦æ˜¯ä»€ä¹ˆï¼Ÿè¯·åœ¨ **Chapter 4** å¯»æ‰¾"å·¥ä½œæµçš„é‡‘å­—å¡”"çš„ç§˜å¯†ã€‚

---

## é™„å½•

### A. ç›¸å…³æ–‡ä»¶

| æ–‡ä»¶ | ç”¨é€” | Git Hash | MEU çŠ¶æ€ |
|------|------|----------|----------|
| `.claude/commands/ccw.md` | Phase 1 æ„å›¾åˆ†æ | `a2242e85` | ğŸŸ¢ Stable |
| `.claude/commands/ccw-plan.md` | Phase 2 å·¥ä½œæµé€‰æ‹© | `b1875d9d` | ğŸŸ¢ Stable |
| `.ccw/workflows/cli-templates/schemas/` | è¾“å‡ºç»“æ„å®šä¹‰ | (ç›®å½•) | ğŸŸ¢ Stable |

> **MEU çŠ¶æ€è¯´æ˜**:
> - ğŸŸ¢ **Stable**: èµ„äº§åœ¨æœ€è¿‘ 30 å¤©å†…æ— å˜æ›´ï¼ŒMEU ç»„åˆç¨³å®š

### B. task_type é€ŸæŸ¥è¡¨

| task_type | è§¦å‘å…³é”®è¯ | Level | å·¥ä½œæµ |
|-----------|-----------|-------|--------|
| bugfix-hotfix | urgent + fix | 2 | bugfix.hotfix |
| brainstorm | å¤´è„‘é£æš´, åˆ›æ„ | 4 | brainstorm-with-file |
| debug-file | æ·±åº¦è°ƒè¯•, å‡è®¾ | 3 | debug-with-file |
| analyze-file | åä½œåˆ†æ, ç†è§£ | 3 | analyze-with-file |
| bugfix | fix, bug, error | 2 | bugfix.standard |
| tdd | tdd, test first | 3 | tdd |
| review | review | 3 | review-cycle-fix |
| feature | (é»˜è®¤) | 2/3 | rapid/coupled |
| exploration | uncertain, explore | 4 | full |

### C. ä¸‹ä¸€ç« 

[Chapter 4: å·¥ä½œæµçš„é‡‘å­—å¡” â€” çº§åˆ«æ˜ å°„ä¸å‘½ä»¤é“¾](./04-workflow-pyramid.md) - æ­ç§˜ Level 1-4 çš„è®¾è®¡å“²å­¦

---

## D. æœ¬ç« èµ„äº§æ¸…å•

| ç±»å‹ | æ–‡ä»¶ | Hash | MEU çŠ¶æ€ | å®¡è®¡çŠ¶æ€ |
|------|------|------|----------|----------|
| Command | `.claude/commands/ccw.md` | `a2242e85` | ğŸŸ¢ Stable | âœ… |
| Command | `.claude/commands/ccw-plan.md` | `b1875d9d` | ğŸŸ¢ Stable | âœ… |
| Schema | `.ccw/workflows/cli-templates/schemas/` | (ç›®å½•) | ğŸŸ¢ Stable | âœ… |

---

*ç‰ˆæœ¬: 2.1.0*
*ä¼šè¯: ANL-ccw-architecture-audit-2025-02-17*
*é£æ ¼: "å°è¯´åŒ–"å°ç¨¿ç‰ˆ*
*æœ€åæ›´æ–°: Round 12 - Chapter 3 æ„å›¾çš„å®¡åˆ¤åº­*
