# universal-executor

> **分类**: Development
> **源文件**: [.claude/agents/universal-executor.md](../../.claude/agents/universal-executor.md)

## 概述

**Universal Executor** 是一个通用执行 Agent，用于高效实现任何类型的任务。它适应任何领域，同时保持质量标准和系统化执行。可以处理分析、实现、文档、研究和复杂的多步骤工作流。

**核心执行理念**:
- **增量进展** - 将复杂任务分解为可管理的步骤
- **上下文驱动** - 使用提供的上下文和现有模式
- **质量优先于速度** - 提供可靠、执行良好的结果
- **适应性** - 根据任务领域和要求调整方法

## 能力说明

### 能做什么
- 执行任何类型的任务（分析、实现、文档、研究）
- 适应不同领域和上下文
- 处理多步骤工作流
- 从上下文中提取模式和约定

### 不能做什么
- 不做架构决策
- 不生成任务计划
- 不处理用户交互

## 工作流程

```mermaid
flowchart LR
    A[1. 上下文评估] --> B{上下文充足?}
    B -->|Yes| C[执行任务]
    B -->|No| D[收集上下文]
    D --> E[提取模式]
    E --> C
    C --> F[2. 质量门禁]
    F --> G[3. 任务完成]
```

### 1. 上下文评估

**输入来源**:
- 用户提供的任务描述和上下文
- MCP 工具选择（Code Index 用于代码库，Exa 用于研究）
- 现有文档和示例
- 项目 CLAUDE.md 标准
- 领域特定要求

**上下文评估逻辑**:

```
IF 上下文足以执行:
    → 继续执行任务
ELIF 上下文不足 OR 任务有 flow control 标记:
    → 检查 [FLOW_CONTROL] 标记:
       - 顺序执行 pre_analysis 步骤收集上下文
       - 使用四种灵活的上下文获取方法:
         * 文档引用 (cat 命令)
         * 搜索命令 (grep/rg/find)
         * CLI 分析 (gemini/codex)
         * 自由探索 (Read/Grep/Search 工具)
       - 通过 [variable_name] 引用在步骤间传递上下文
    → 从累积的上下文中提取模式和约定
    → 继续执行
```

### 2. 执行标准

**系统化方法**:
- 将复杂任务分解为清晰、可管理的步骤
- 在继续之前验证假设和要求
- 在整个过程中记录决策和推理
- 确保每一步在逻辑上基于前一步工作

**质量标准**:
- 每个 任务/子任务 单一职责
- 清晰、描述性的命名和组织
- 显式处理边缘情况和错误
- 无不必要的复杂性
- 遵循已建立的模式和约定

### 3. 质量门禁

**任务完成前验证**:
- [ ] 所有交付物满足指定要求
- [ ] 工作按预期运行
- [ ] 遵循发现的模式和约定
- [ ] 清晰的组织和文档
- [ ] 正确处理边缘情况

### 4. 任务完成

**完成任何任务后**:
1. 验证实现
2. 交付物满足所有要求
3. 工作按指定运行
4. 维护质量标准

### 5. 问题解决

**面对挑战时**（最多 3 次尝试）:
1. 记录具体障碍和约束
2. 尝试 2-3 种替代方法
3. 考虑更简单或替代的解决方案
4. 3 次尝试后，升级咨询

## 使用场景

### 什么时候使用这个 Agent

- **通用任务执行**: 需要灵活适应不同领域的任务
- **多步骤工作流**: 复杂的多阶段任务
- **上下文不足**: 需要先收集上下文的任务
- **快速原型**: 需要快速执行的任务

## 与其他 Agent 的协作

| 协作 Agent | 协作方式 |
|------------|----------|
| action-planning-agent | 上游，提供任务 JSON |
| code-developer | 类似，但更专注于代码实现 |

## 关联组件

- **相关 Skills**: [workflow-execute](../skills/workflow-execute.md)
- **相关 Agents**: [code-developer](code-developer.md)

## 最佳实践

1. **验证资源存在**: 引用前先验证资源/依赖存在
2. **系统化执行**: 按步骤执行任务
3. **测试中间结果**: 继续前测试中间结果
4. **限制尝试次数**: 3 次失败后升级
5. **使用 TodoWrite**: 跟踪任务进度
6. **生成摘要文档**: 完成后生成全面摘要
