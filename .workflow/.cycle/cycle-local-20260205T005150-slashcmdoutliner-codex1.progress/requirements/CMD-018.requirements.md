# Requirement (non-leaky): /memory:compact

## Source

- Command doc (oracle, do not paste full contents into spec): `.claude/commands/memory/compact.md`

## Command Identity

- group: memory
- name: compact
- description: Compact current session memory into structured text for session recovery, extracting objective/plan/files/decisions/constraints/state, and save via MCP core_memory tool
- argument-hint: [optional: session description]
- allowed-tools: mcp__ccw-tools__core_memory(*), Read(*)

## Structure Hints (Headings Only)

- Memory Compact Command (/memory:compact)
  - 1. Overview
  - 2. Parameters
  - 3. Structured Output Format
  - Session ID
  - Project Root
  - Objective
  - Execution Plan
    - Source: [workflow | todo | user-stated | inferred]
  - Phase 1: Setup
  - Phase 2: Implementation
  - Working Files (Modified)
  - Reference Files (Read-Only)
  - Last Action
  - Decisions
  - Constraints
  - Dependencies
  - Known Issues
  - Changes Made
  - Pending
  - Notes
  - 4. Field Definitions
  - 5. Execution Flow
    - Step 1: Analyze Current Session
    - Step 2: Generate Structured Text
  - Project Root
  - Objective
  - Execution Plan
  - Working Files (Modified)
  - Reference Files (Read-Only)
  - Last Action
  - Decisions
  - Constraints
  - Dependencies
  - Known Issues
  - Changes Made
  - Pending
  - Notes
    - Step 3: Import to Core Memory via MCP
- Write structured text to temp file, then import
- Or from a file
    - Step 4: Report Recovery ID
  - 6. Quality Checklist
  - 7. Path Resolution Rules
    - Project Root Detection
    - Absolute Path Conversion
    - Reference File Categories
  - 8. Plan Detection (Priority Order)
    - Priority 1: Workflow Session (IMPL_PLAN.md)
    - Priority 2: TodoWrite (Current Session Todos)
    - Priority 3: User-Stated Plan
    - Priority 4: Inferred Plan
  - 9. Notes

## Hard Constraints (P0)

- Do not claim a pointer is `Existing` unless it is verifiable in the repo now.
- Evidence must be dual-source: docs (.claude/commands/**.md) + ts (ccw/src/**).
- If unsure, mark as `Planned` and add a concrete `Verify` step.
