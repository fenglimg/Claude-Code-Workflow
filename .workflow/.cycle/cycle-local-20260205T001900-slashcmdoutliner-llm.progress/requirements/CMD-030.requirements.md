# Requirement (non-leaky): /workflow:role-analysis

## Source

- Command doc (oracle, do not paste full contents into spec): `.claude/commands/workflow/brainstorm/role-analysis.md`

## Command Identity

- group: workflow
- name: role-analysis
- description: Unified role-specific analysis generation with interactive context gathering and incremental updates
- argument-hint: [role-name] [--session session-id] [--update] [--include-questions] [--skip-questions]
- allowed-tools: Task(conceptual-planning-agent), AskUserQuestion(*), TodoWrite(*), Read(*), Write(*), Edit(*), Glob(*)

## Structure Hints (Headings Only)

  - ğŸ¯ **Unified Role Analysis Generator**
    - Purpose
    - Core Function
    - Supported Roles
  - ğŸ“‹ **Usage**
- Generate new analysis with interactive context
- Generate with existing framework + context questions
- Update existing analysis (incremental merge)
- Quick generation (skip interactive context)
  - âš™ï¸ **Execution Protocol**
    - Phase 1: Detection & Validation
    - Phase 2: Interactive Context Gathering
    - Phase 3: Agent Execution
  - Context Loading
  - Flow Control Steps
  - Analysis Requirements
  - Expected Deliverables
  - Update Requirements (if UPDATE_MODE)
  - Completion Criteria
    - Phase 4: Validation & Finalization
  - ğŸ“‹ **TodoWrite Integration**
    - Workflow Progress Tracking
  - ğŸ“Š **Output Structure**
    - Directory Layout
    - Analysis Document Structure (New Generation)
- ${roleConfig[role_name].title} Analysis: [Topic from Framework]
  - Framework Reference
  - User Context Summary
  - Discussion Points Analysis
    - Core Requirements (from framework)
    - Technical Considerations (from framework)
    - User Experience Factors (from framework)
    - Implementation Challenges (from framework)
    - Success Metrics (from framework)
  - ${roleConfig[role_name].title} Specific Recommendations
    - Analysis Document Structure (Incremental Update)
- ${roleConfig[role_name].title} Analysis: [Topic]
  - Framework Reference
  - Clarifications
    - Session ${new Date().toISOString().split('T')[0]}
  - User Context Summary
  - Discussion Points Analysis
  - ğŸ”„ **Integration with Other Commands**
    - Called By
    - Calls To
    - Coordinates With
  - âœ… **Quality Assurance**
    - Required Analysis Elements
    - Context Quality
    - Update Quality (if update_mode)
  - ğŸ›ï¸ **Command Parameters**
    - Required Parameters
    - Optional Parameters
    - Parameter Combinations
  - ğŸš« **Error Handling**
    - Invalid Role Name
    - No Active Session
    - Missing Framework (with warning)
    - Agent Execution Failure
  - ğŸ”§ **Advanced Usage**
    - Batch Role Generation (via auto-parallel)
- This command handles multiple roles in parallel
- â†’ Internally calls role-analysis for each selected role
    - Manual Multi-Role Workflow
- 1. Create framework
- 2. Generate each role with context
- 3. Synthesize insights
    - Iterative Refinement
- Initial generation
- User reviews and wants more depth
- â†’ Asks clarification questions, merges new insights
  - ğŸ“š **Reference Information**
    - Role Template Locations
    - Related Commands
    - Context Package

## Hard Constraints (P0)

- Do not claim a pointer is `Existing` unless it is verifiable in the repo now.
- Evidence must be dual-source: docs (.claude/commands/**.md) + ts (ccw/src/**).
- If unsure, mark as `Planned` and add a concrete `Verify` step.
