# Requirement (non-leaky): /workflow:complete

## Source

- Command doc (oracle, do not paste full contents into spec): `.claude/commands/workflow/session/complete.md`

## Command Identity

- group: workflow
- name: complete
- description: Mark active workflow session as complete, archive with lessons learned, update manifest, remove active flag
- argument-hint: [-y|--yes] [--detailed]
- allowed-tools: TBD

## Structure Hints (Headings Only)

- Complete Workflow Session (/workflow:session:complete)
  - Pre-defined Commands
- Phase 1: Find active session
- Phase 3: Move to archive
- Cleanup marker
  - Key Files to Read
  - Execution Flow
    - Phase 1: Find Session (2 commands)
- 1. Find and extract session
- 2. Check/create archiving marker
    - Phase 2: Generate Manifest Entry (Read-only)
    - Phase 3: Atomic Commit (4 commands)
- 1. Create archive directory
- 2. Move session
- 3. Update manifest.json (Read → Append → Write)
- Read: .workflow/archives/manifest.json (or [])
- Append: archive_entry from Phase 2
- Write: updated JSON
- 4. Remove marker
    - Phase 4: Update project-tech.json (Optional)
- Check
    - Phase 5: Ask About Solidify (Always)
  - Auto Mode Defaults
  - Error Recovery
  - Quick Reference

## Hard Constraints (P0)

- Do not claim a pointer is `Existing` unless it is verifiable in the repo now.
- Evidence must be dual-source: docs (.claude/commands/**.md) + ts (ccw/src/**).
- If unsure, mark as `Planned` and add a concrete `Verify` step.
