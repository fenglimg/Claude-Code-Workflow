# Requirement (non-leaky): /workflow:replan

## Source

- Command doc (oracle, do not paste full contents into spec): `.claude/commands/workflow/replan.md`

## Command Identity

- group: workflow
- name: replan
- description: Interactive workflow replanning with session-level artifact updates and boundary clarification through guided questioning
- argument-hint: [-y|--yes] [--session session-id] [task-id] \"requirements\"|file.md [--interactive]
- allowed-tools: Read(*), Write(*), Edit(*), TodoWrite(*), Glob(*), Bash(*)

## Structure Hints (Headings Only)

- Workflow Replan Command
  - Overview
  - Operation Modes
    - Session Replan Mode
- Auto-detect active session
- Explicit session
- File-based input
- Interactive mode
    - Task Replan Mode
- Direct task update
- Task with explicit session
- Interactive mode
  - Execution Process
  - Execution Lifecycle
    - Input Parsing
    - Phase 1: Mode Detection & Session Discovery
    - Auto Mode Support
    - Phase 2: Interactive Requirement Clarification
      - Session Mode Questions
      - Task Mode Questions
    - Phase 3: Impact Analysis & Planning
  - 修改计划
    - 影响范围
    - 变更操作
    - Phase 4: Backup Creation
- Replan Backup Manifest
  - Restoration Command
    - Phase 5: Apply Modifications
    - Phase 6: Verification & Summary
  - 重规划完成
    - 会话信息
    - 变更摘要
    - 修改的文件
    - 任务变更
    - 回滚方法
  - TodoWrite Progress Tracking
    - Session Mode Progress
    - Task Mode Progress
  - Error Handling
    - Session Errors
- No active session found
- Session not found
- No changes specified
    - Task Errors
- Task not found
- Task completed
- Circular dependency
    - Validation Errors
- Task limit exceeded
- Invalid JSON
  - File Structure
  - Examples
    - Session Replan - Add Feature
- Interactive clarification
- Execution
    - Task Replan - Update Requirements
- Interactive clarification
- Execution
    - Task Replan - Change Execution Method
- Semantic parsing detects executionIntent:
- { method: 'cli', cli_tool: 'codex' }
- Execution (no interactive questions needed)
- Semantic parsing detects executionIntent:
- { method: 'agent', cli_tool: null }
- Execution

## Hard Constraints (P0)

- Do not claim a pointer is `Existing` unless it is verifiable in the repo now.
- Evidence must be dual-source: docs (.claude/commands/**.md) + ts (ccw/src/**).
- If unsure, mark as `Planned` and add a concrete `Verify` step.
