# Requirement (non-leaky): /workflow:clean

## Source

- Command doc (oracle, do not paste full contents into spec): `.claude/commands/workflow/clean.md`

## Command Identity

- group: workflow
- name: clean
- description: Intelligent code cleanup with mainline detection, stale artifact discovery, and safe execution
- argument-hint: [-y|--yes] [--dry-run] [\"focus area\"]
- allowed-tools: TodoWrite(*), Task(*), AskUserQuestion(*), Read(*), Glob(*), Bash(*), Write(*)

## Structure Hints (Headings Only)

- Clean Command (/workflow:clean)
  - Overview
  - Usage
  - Auto Mode Defaults
  - Execution Process
  - Implementation
    - Phase 1: Mainline Detection
- Get commit frequency by directory (last 30 days)
- Get recent active branches
- Get files with most recent changes
    - Phase 2: Drift Discovery
  - Task Objective
  - Context
  - Discovery Categories
    - Category 1: Stale Workflow Sessions
    - Category 2: Drifted Documents
    - Category 3: Dead Code
  - Output Format
  - Execution Commands
- Session directories
- Check modification times (Linux/Mac)
- Check modification times (Windows PowerShell via bash)
- Find orphan exports (TypeScript)
- Find imports
- Find large comment blocks
- Find old TODOs
  - Success Criteria
    - Phase 3: Confirmation
  - Cleanup Discovery Report
    - Summary
    - Stale Sessions
    - Drifted Documents
    - Dead Code
    - Phase 4: Execution
  - Cleanup Complete
    - Deleted Items
    - Failed Items
  - Session Folder Structure
  - Risk Level Definitions
  - Error Handling
  - Related Commands

## Hard Constraints (P0)

- Do not claim a pointer is `Existing` unless it is verifiable in the repo now.
- Evidence must be dual-source: docs (.claude/commands/**.md) + ts (ccw/src/**).
- If unsure, mark as `Planned` and add a concrete `Verify` step.
