# Requirement (non-leaky): /workflow:style-extract

## Source

- Command doc (oracle, do not paste full contents into spec): `.claude/commands/workflow/ui-design/style-extract.md`

## Command Identity

- group: workflow
- name: style-extract
- description: Extract design style from reference images or text prompts using Claude analysis with variant generation or refinement mode
- argument-hint: [-y|--yes] [--design-id <id>] [--session <id>] [--images "<glob>"] [--prompt "<desc>"] [--variants <count>] [--interactive] [--refine]
- allowed-tools: TodoWrite(*), Read(*), Write(*), Glob(*), AskUserQuestion(*)

## Structure Hints (Headings Only)

  - Auto Mode
- Style Extraction Command
  - Overview
  - Execution Process
  - Phase 0: Setup & Input Validation
    - Step 1: Detect Input Mode, Extraction Mode & Base Path
- Detect input source
- Priority: --images + --prompt → hybrid | --images → image | --prompt → text
- Detect refinement mode
- Set variants count
- Refinement mode: Force variants_count = 1 (ignore user-provided --variants)
- Exploration mode: Use --variants or default to 3 (range: 1-5)
- Determine base path with priority: --design-id > --session > auto-detect
- Validate and convert to absolute path
    - Step 2: Load Inputs
- For image mode
- For text mode
- Validate --prompt is non-empty
- Create output directory
    - Step 3: Memory Check
- 1. Check if inputs cached in session memory
- 2. Check if output already exists
  - Phase 1: Design Direction or Refinement Options Generation
    - Step 1: Load Project Context
- Load brainstorming context if available
- Load existing design system if refinement mode
    - Step 2: Generate Options (Agent Task 1 - Mode-Specific)
    - Step 3: Verify Options File Created
- Quick validation
  - Phase 1.5: User Confirmation (Optional - Triggered by --interactive)
    - Step 1: Check Interactive Flag
- Skip this entire phase if --interactive flag is not present
    - Step 2: Load and Present Options (Mode-Specific)
- Read options file
- Branch based on mode
    - Step 3: Present Options to User (Mode-Specific)
    - Step 4: Capture User Selection and Update Analysis JSON
    - Step 5: Confirmation Message (Mode-Specific)
  - Phase 2: Design System Generation (Agent Task 2)
    - Step 1: Load User Selection or Default to All
- Read analysis-options.json which may contain user_selection
- Check if user_selection field exists (interactive mode)
- Extract the selected direction details from options
    - Step 2: Create Output Directories
- Create directories for each selected variant
    - Step 3: Launch Agent Tasks (Parallel)
  - Phase 3: Verify Output
    - Step 1: Check Files Created
- Verify all design systems created
- Validate structure
    - Step 2: Verify File Sizes
  - Completion
    - Todo Update
    - Output Message
  - Simple Bash Commands
    - Path Operations
- Find design directory
- Expand image pattern
- Create output directory
    - Validation Commands
- Check if already extracted
- Count variants
- Validate JSON structure
    - File Operations
- Load brainstorming context
- Create directories (example for multiple variants)
- Verify output
  - Output Structure
  - design-tokens.json Format
  - Error Handling
    - Common Errors
  - Key Features

## Hard Constraints (P0)

- Do not claim a pointer is `Existing` unless it is verifiable in the repo now.
- Evidence must be dual-source: docs (.claude/commands/**.md) + ts (ccw/src/**).
- If unsure, mark as `Planned` and add a concrete `Verify` step.
