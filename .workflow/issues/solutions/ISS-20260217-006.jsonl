{"id":"SOL-ISS-20260217-006-x4k8","description":"撰写 CCW 深度研习文档 Chapter 10.7，分析 TS 与 Python 跨语言错误处理机制，重点关注错误类型映射、堆栈追踪和故障恢复","approach":"基于 OUTLINE.md 中定义的 Chapter 10.7 结构，分析 cli-executor-utils.ts 和 cli-executor-core.ts 中的错误处理逻辑，创建 Python 异常到 TS 错误的映射表，记录进程重启策略和降级模式。","tasks":[{"id":"T1","title":"创建 Python 异常到 TS 错误映射表","scope":"docs/deep-study/part4-5-cross-language","action":"Create","description":"分析并记录 Python 异常类型如何映射到 TypeScript 错误类型，标注处理策略","files":[{"path":"docs/deep-study/part4-5-cross-language/10.7-error-boundary.md","action":"create","change":"创建新文件，包含错误类型映射表"}],"implementation":["分析 Python ValueError → TS TypeError (参数验证)","分析 Python FileNotFoundError → TS ENOENT (文件检查)","分析 Python ImportError → TS DependencyError (环境诊断)","分析 Python KeyboardInterrupt → TS AbortError (清理退出)","分析自定义异常 → TS CliExecutionError (原始信息保留)","记录 JSON-RPC error 对象结构 (-32601 Method not found, -32603 Internal error)"],"test":{"commands":["grep -n 'error' ccw/src/tools/cli-executor-core.ts | head -30"],"manual_checks":["验证错误映射与实际代码一致"]},"convergence":{"criteria":["至少 5 种异常类型映射","每种映射有处理策略说明","JSON-RPC 错误码完整记录"],"verification":"技术审校确认映射准确性"},"commit":{"type":"docs","scope":"deep-study","message_template":"docs(deep-study): create Chapter 10.7 error boundary and recovery"},"depends_on":[],"priority":"high"},{"id":"T2","title":"分析 cli-executor-core.ts 错误处理流程","scope":"docs/deep-study/part4-5-cross-language","action":"Add","description":"深入分析进程错误处理、exit code 判断、stderr 内容分类机制","files":[{"path":"docs/deep-study/part4-5-cross-language/10.7-error-boundary.md","action":"modify","target":"第二幕：思维脉络","change":"添加错误处理流程分析"}],"implementation":["分析 child.on('error') 的进程启动失败处理","分析 child.on('close') 中的 exit code 判断逻辑 (code !== 0)","分析 hasFatalError 检测 (FATAL, Authentication failed, API key, rate limit)","分析 hasValidOutput 的宽容策略（有输出则视为成功）","绘制错误处理状态转换图"],"test":{"commands":["grep -n 'hasFatalError\\|hasValidOutput' ccw/src/tools/cli-executor-core.ts"],"manual_checks":["验证错误判断逻辑与源码一致"]},"convergence":{"criteria":["进程错误处理流程清晰","exit code 判断策略准确","stderr 分类机制完整"],"verification":"源码对照验证"},"commit":null,"depends_on":["T1"],"priority":"medium"},{"id":"T3","title":"撰写堆栈信息追踪与保留机制","scope":"docs/deep-study/part4-5-cross-language","action":"Add","description":"分析 Python 异常堆栈如何通过 stderr 传递到 TS 端，如何保留原始堆栈信息","files":[{"path":"docs/deep-study/part4-5-cross-language/10.7-error-boundary.md","action":"modify","target":"第二幕：思维脉络 - 堆栈追踪","change":"添加堆栈信息追踪章节"}],"implementation":["分析 Python traceback 通过 stderr 传递的格式","记录 TS 端 errorLog() 函数的堆栈输出逻辑 (DEBUG 模式)","分析 debugLog() 和 errorLog() 的分类日志机制","记录堆栈截断策略 (stderr.substring(0, 2048))"],"test":{"commands":["grep -n 'errorLog\\|debugLog' ccw/src/tools/cli-executor-utils.ts | head -20"],"manual_checks":["验证堆栈处理逻辑与源码一致"]},"convergence":{"criteria":["Python 堆栈传递机制清晰","TS 端堆栈保留策略准确","截断策略说明完整"],"verification":"技术审校确认"},"commit":null,"depends_on":["T1"],"priority":"medium"},{"id":"T4","title":"撰写故障恢复机制与进程重启策略","scope":"docs/deep-study/part4-5-cross-language","action":"Add","description":"分析进程重启策略、降级模式（跳过 Python 功能）、用户友好错误消息生成","files":[{"path":"docs/deep-study/part4-5-cross-language/10.7-error-boundary.md","action":"modify","target":"第五幕：进化的插槽 + 事故复盘档案","change":"添加故障恢复机制章节"}],"implementation":["分析 killCurrentCliProcess() 的进程清理机制","记录 LiteLLM 降级路由（Python 不可用时使用 API endpoint）","分析 CLI封装 endpoint 的 fallback 策略","撰写事故复盘：unhandled Python exception 级联导致 OOM","添加幽灵线索：Python 异常未捕获 → stderr 满 → 进程假死 → OOM Killer"],"test":{"manual_checks":["验证降级策略与实际实现一致"]},"convergence":{"criteria":["进程重启策略清晰","降级模式说明完整","事故复盘包含幽灵线索"],"verification":"Review 故障恢复方案完整性"},"commit":null,"depends_on":["T1"],"priority":"medium"},{"id":"T5","title":"添加资产证言与错误边界陷阱","scope":"docs/deep-study/part4-5-cross-language","action":"Add","description":"撰写 stderr 的第一人称资产证言，添加架构陷阱：为什么不让 Python 异常直接冒泡到 TS？","files":[{"path":"docs/deep-study/part4-5-cross-language/10.7-error-boundary.md","action":"modify","target":"0. 资产证言 + 苏格拉底式思考","change":"添加资产证言和架构陷阱"}],"implementation":["撰写 stderr 证言：'我是间谍通道...我见过无数秘密被泄露...但我的缓冲区一旦满了，信使就会失踪'","添加陷阱：为什么不直接冒泡异常？揭示：跨语言异常无法序列化、堆栈信息丢失、用户体验差","添加调查进度条和幽灵位置标注"],"test":{"manual_checks":["证言风格与现有章节一致"]},"convergence":{"criteria":["资产证言符合小说化风格","架构陷阱有揭示部分","幽灵追踪线索指向错误级联问题"],"verification":"风格审校确认"},"commit":null,"depends_on":["T1"],"priority":"low"}],"exploration_context":{"relevant_files":["ccw/src/tools/cli-executor-core.ts","ccw/src/tools/cli-executor-utils.ts","codex-lens/src/codexlens/cli/","docs/deep-study/OUTLINE.md"],"patterns":"Python异常 → stderr传递 → TS错误映射 → 堆栈保留 → 故障恢复","integration_points":"cli-executor-core.ts 的 child.on('error') 和 child.on('close') 是错误处理入口点"},"analysis":{"risk":"low","impact":"medium","complexity":"medium"},"score":0.87,"is_bound":true,"bound_at":"2026-02-17T14:12:04.269Z"}
