{"id":"SOL-ISS-20260217-012-f8a3","description":"撰写 Chapter 15-16 文档，涵盖 SQLite 数据库设计与文件系统工作流架构","approach":"采用小说化叙事风格，延续 OOM 幽灵暗线，分析 db-loader.ts 的 SQLite 加载机制、dir_index.py 的表结构设计，以及 .workflow/ 目录的一致性保证。Ghost clue 聚焦于数据库锁竞争问题。","tasks":[{"id":"T1","title":"Create Chapter 15: SQLite Database Design","scope":"docs/deep-study/part7-storage-layer","action":"Create","description":"撰写 Chapter 15，分析 CCW SQLite 数据库设计，包括表结构、迁移机制与锁竞争问题","files":[{"path":"docs/deep-study/part7-storage-layer/15-sqlite-database.md","action":"create","change":"新建章节文档，包含 sessions/cli_history/memory_embeddings 表结构、WAL 模式配置、迁移管理"}],"implementation":["创建 docs/deep-study/part7-storage-layer/ 目录","撰写章节标题与概述，Ghost clue: Database locked 错误","分析 ccw/src/utils/db-loader.ts：better-sqlite3 加载与 NODE_MODULE_VERSION 错误处理","分析 ccw/src/tools/cli-executor-state.ts：ConversationRecord 与 ExecutionRecord 数据结构","分析 codex-lens/storage/dir_index.py：DirIndexStore 表结构（files, subdirs, symbols, fts）","分析 codex-lens/storage/vector_meta_store.py：VectorMetadataStore 表结构（chunk_metadata, binary_vectors）","绘制 SQLite Schema 架构图","添加 WAL 模式与线程安全说明","编写事故复盘档案：17 transactions rolled back 的事故分析"],"test":{"commands":["ls -la docs/deep-study/part7-storage-layer/15-sqlite-database.md"],"manual_checks":["表结构 ER 图正确","WAL 模式说明完整","包含 Ghost clue 引用"]},"convergence":{"criteria":["文件 docs/deep-study/part7-storage-layer/15-sqlite-database.md 已创建","文档长度 >= 300 行，包含 3+ Mermaid 图","涵盖 sessions、cli_history、memory_embeddings 表分析","包含数据库锁竞争 Ghost clue"],"verification":["wc -l docs/deep-study/part7-storage-layer/15-sqlite-database.md","grep -c 'mermaid' docs/deep-study/part7-storage-layer/15-sqlite-database.md","grep -c 'Ghost clue' docs/deep-study/part7-storage-layer/15-sqlite-database.md"]},"commit":{"type":"docs","scope":"deep-study","message_template":"docs(deep-study): add Chapter 15 - SQLite Database Design"},"priority":"high","depends_on":[]},{"id":"T2","title":"Create Chapter 16: File System Workflow","scope":"docs/deep-study/part7-storage-layer","action":"Create","description":"撰写 Chapter 16，分析 .workflow/ 目录结构与文件系统一致性保证机制","files":[{"path":"docs/deep-study/part7-storage-layer/16-filesystem-workflow.md","action":"create","change":"新建章节文档，包含 .workflow/ 目录结构、storage-paths.ts 配置、原子写入保证"}],"implementation":["撰写章节标题与概述，继续 OOM 幽灵叙事","分析 .workflow/ 目录结构：.analysis, .cycle, .execution, .lite-plan, .scratchpad, .team, .team-msg, issues","分析 ccw/src/config/storage-paths.ts：StoragePaths 类与路径配置","分析 cli-executor-state.ts 中的 ensureHistoryDir 与 saveConversation 原子写入","绘制 .workflow/ 目录树与文件生命周期图","添加文件系统一致性保证说明（原子写入、备份机制）","编写事故复盘档案：并发写入导致的文件损坏案例"],"test":{"commands":["ls -la docs/deep-study/part7-storage-layer/16-filesystem-workflow.md"],"manual_checks":["目录树结构完整","文件生命周期图清晰","包含一致性保证说明"]},"convergence":{"criteria":["文件 docs/deep-study/part7-storage-layer/16-filesystem-workflow.md 已创建","文档长度 >= 280 行，包含 3+ Mermaid 图","涵盖 .workflow/ 8+ 子目录分析","包含文件系统一致性机制说明"],"verification":["wc -l docs/deep-study/part7-storage-layer/16-filesystem-workflow.md","grep -c 'mermaid' docs/deep-study/part7-storage-layer/16-filesystem-workflow.md"]},"commit":{"type":"docs","scope":"deep-study","message_template":"docs(deep-study): add Chapter 16 - File System Workflow"},"priority":"high","depends_on":["T1"]}],"analysis":{"risk":"low","impact":"medium","complexity":"low"},"score":0.88,"is_bound":true,"bound_at":"2026-02-17T14:06:51.291Z"}
